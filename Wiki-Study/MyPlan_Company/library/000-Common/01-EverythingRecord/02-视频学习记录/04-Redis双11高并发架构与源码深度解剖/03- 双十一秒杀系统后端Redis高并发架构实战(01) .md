# redis 手动模拟高并发场景秒杀下单超卖Bug


![](assets/000/01/02/04/03-1610680719072.png)

## 1 后台代码


模拟接口减少库存，且加上synchronized 的情况(加上了 synchronized ，按道理来说淡季情况下没问题，但是本次模拟是两台机器，分布式的后台下)


![](assets/000/01/02/04/03-1610689292876.png)

## 2 jmeter  模拟高并发下，减少库存的后台是否有bug

> 1 创建测试组

![](assets/000/01/02/04/03-1610688999607.png)

第一个参数：多少个请求
第二个参数 ：几秒内发完请求
第三个参数：代表轮询执行几次

> 2 打开压测报告

![](assets/000/01/02/04/03-1610689100998.png)

> 3 访问nginx 做了两台后台服务的负载均衡


* 结果，两个后台只要又出现了相同的库存数，就说明超卖情况就发生了


## 3 发生了 超卖情况如何去解决呢，（当前系统模拟的是redis 中进行操作，所以redis 有一个 setnx ，就是分布式锁）


![](assets/000/01/02/04/03-1610689403863.png)