
## docker ç›´æ¥æ­å»ºrustdesk è„šæœ¬è®°å½•



## **è¯´æ˜**

docker å®‰è£…é…ç½®å¥½ä»¥åå¯ä»¥åˆ›å»ºå¦‚ä¸‹è„šæœ¬æ–‡ä»¶å¹¶æ‰§è¡Œï¼›


### **ä½¿ç”¨ä¸€é”®è„šæœ¬ï¼š**

```bash

# åˆ›å»ºè„šæœ¬
nano deploy_rustdesk.sh

# å¤åˆ¶ä¸Šé¢çš„è„šæœ¬å†…å®¹ï¼Œä¿å­˜åæ‰§è¡Œ
chmod +x deploy_rustdesk.sh

# è‡ªå·±å®šä¹‰è„šæœ¬å­˜æ”¾åœ¨å“ªé‡Œï¼Œä½†æ˜¯æ­¤è„šæœ¬æ˜¯åœ¨å®¶ç›®å½•ä¸‹é¢åˆ›å»ºçš„ï¼Œæ‰€ä»¥æœ€ç»ˆçš„è„šæœ¬æ–‡ä»¶ dockercomposeæ–‡ä»¶ä¹Ÿæ˜¯åœ¨å®¶ç›®å½•ä¸‹ï¼›å¦‚æœæƒ³æ›´æ”¹åœ°å€ï¼Œåˆ™å¯ä»¥ä¿®æ”¹ç›®å½•ä¸­çš„ä½ç½®
./deploy_rustdesk.sh
```


## ğŸ› ï¸ **ä¸€é”®éƒ¨ç½²è„šæœ¬**

```bash
#!/bin/bash

echo "=== RustDesk æœåŠ¡å™¨ä¸€é”®éƒ¨ç½²è„šæœ¬ ==="

# è·å–æœåŠ¡å™¨IP
# SERVER_IP=$(curl -s ifconfig.me)
SERVER_IP="ä½ çš„æœåŠ¡å™¨IP"
echo "æ£€æµ‹åˆ°æœåŠ¡å™¨IP: $SERVER_IP"

# åˆ›å»ºç›®å½•
mkdir -p ~/rustdesk
cd ~/rustdesk

# åˆ›å»ºdocker-composeæ–‡ä»¶
cat > docker-compose.yml <<EOF

networks:
  rustdesk-net:
    external: false

services:
  hbbs:
    container_name: hbbs
    ports:
      - 21115:21115
      - 21116:21116
      - 21116:21116/udp
      - 21118:21118
    image: rustdesk/rustdesk-server:latest
    command: hbbs -r $SERVER_IP:21117
    volumes:
      - ./data:/root
    networks:
      - rustdesk-net
    depends_on:
      - hbbr
    restart: unless-stopped

  hbbr:
    container_name: hbbr
    ports:
      - 21117:21117
      - 21119:21119
    image: rustdesk/rustdesk-server:latest
    command: hbbr
    volumes:
      - ./data:/root
    networks:
      - rustdesk-net
    restart: unless-stopped
EOF

# åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p data

# å¯åŠ¨æœåŠ¡
echo "æ­£åœ¨å¯åŠ¨RustDeskæœåŠ¡..."
docker compose up -d

# ç­‰å¾…æœåŠ¡å¯åŠ¨
echo "ç­‰å¾…æœåŠ¡å¯åŠ¨..."
sleep 15

# é…ç½®é˜²ç«å¢™
echo "é…ç½®é˜²ç«å¢™..."
if command -v firewall-cmd &> /dev/null; then
	    sudo firewall-cmd --permanent --add-port=21115-21119/tcp
	        sudo firewall-cmd --permanent --add-port=21116/udp
		    sudo firewall-cmd --reload
	    elif command -v ufw &> /dev/null; then
		        sudo ufw allow 21115:21119/tcp
			    sudo ufw allow 21116/udp
		    fi

		    # æ˜¾ç¤ºé…ç½®ä¿¡æ¯
echo ""
echo "ğŸ‰ RustDesk æœåŠ¡å™¨éƒ¨ç½²å®Œæˆï¼"
echo "=================================="
echo "æœåŠ¡å™¨IP: $SERVER_IP"
echo "IDæœåŠ¡å™¨: $SERVER_IP:21116"
echo "ä¸­ç»§æœåŠ¡å™¨: $SERVER_IP:21117"
echo ""
echo "å…¬é’¥å†…å®¹:"
echo "--------------------------------"
cat data/id_ed25519.pub 2>/dev/null || echo "å…¬é’¥æ–‡ä»¶å°šæœªç”Ÿæˆï¼Œè¯·ç¨ç­‰ç‰‡åˆ»åæ‰§è¡Œ: cat ~/rustdesk/data/id_ed25519.pub"
echo "--------------------------------"
echo ""
echo "Windowså®¢æˆ·ç«¯é…ç½®:"
echo "1. ä¸‹è½½RustDesk: https://rustdesk.com/"
echo "2. è®¾ç½® -> ç½‘ç»œ"
echo "3. IDæœåŠ¡å™¨: $SERVER_IP:21116"
echo "4. ä¸­ç»§æœåŠ¡å™¨: $SERVER_IP:21117"
echo "5. å…¬é’¥: [å¤åˆ¶ä¸Šé¢çš„å…¬é’¥å†…å®¹]"
echo ""
echo "ç®¡ç†å‘½ä»¤:"
echo "æŸ¥çœ‹çŠ¶æ€: cd ~/rustdesk && docker-compose ps"
echo "æŸ¥çœ‹æ—¥å¿—: cd ~/rustdesk && docker-compose logs"
echo "é‡å¯æœåŠ¡: cd ~/rustdesk && docker-compose restart"
echo "åœæ­¢æœåŠ¡: cd ~/rustdesk && docker-compose down"

```



## äº‘æœåŠ¡å™¨éœ€è¦æ³¨æ„


äº‘æœåŠ¡å™¨æˆ‘çš„å°±æ˜¯é˜¿é‡Œçš„ï¼Œ é˜²ç«å¢™å…¶å®éƒ½æ²¡å¼€ï¼Œæœ€åé‚£äº›ç«¯å£éœ€è¦åœ¨é˜¿é‡ŒæœåŠ¡å™¨ä¸Šè¿›è¡Œå…¥æ ˆè§„åˆ™çš„æ·»åŠ æ‰å¯ä»¥


### **ï¼šé…ç½®å®‰å…¨ç»„è§„åˆ™**

#### **æ–¹æ³•1ï¼šé€šè¿‡å®ä¾‹é¡µé¢**

1. ç‚¹å‡»å®ä¾‹IDè¿›å…¥è¯¦æƒ…é¡µ
2. ç‚¹å‡» **"å®‰å…¨ç»„"** æ ‡ç­¾
3. ç‚¹å‡»å®‰å…¨ç»„ID
4. ç‚¹å‡» **"é…ç½®è§„åˆ™"**
5. ç‚¹å‡» **"æ·»åŠ å®‰å…¨ç»„è§„åˆ™"**

#### **æ–¹æ³•2ï¼šç›´æ¥è¿›å…¥å®‰å…¨ç»„ç®¡ç†**

1. å·¦ä¾§èœå• â†’ **"ç½‘ç»œä¸å®‰å…¨"** â†’ **"å®‰å…¨ç»„"**
2. æ‰¾åˆ°ä½ å®ä¾‹ä½¿ç”¨çš„å®‰å…¨ç»„
3. ç‚¹å‡» **"é…ç½®è§„åˆ™"**

### **ç¬¬å››æ­¥ï¼šæ·»åŠ å…¥æ–¹å‘è§„åˆ™**

éœ€è¦æ·»åŠ ä»¥ä¸‹è§„åˆ™ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§„åˆ™æ–¹å‘ â”‚ åè®®ç±»å‹ â”‚ ç«¯å£èŒƒå›´    â”‚ æºåœ°å€      â”‚ æè¿°     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å…¥æ–¹å‘   â”‚ TCP      â”‚ 21115/21115 â”‚ 0.0.0.0/0   â”‚ RustDesk â”‚
â”‚ å…¥æ–¹å‘   â”‚ TCP      â”‚ 21116/21116 â”‚ 0.0.0.0/0   â”‚ RustDesk â”‚
â”‚ å…¥æ–¹å‘   â”‚ UDP      â”‚ 21116/21116 â”‚ 0.0.0.0/0   â”‚ RustDesk â”‚
â”‚ å…¥æ–¹å‘   â”‚ TCP      â”‚ 21117/21117 â”‚ 0.0.0.0/0   â”‚ RustDesk â”‚
â”‚ å…¥æ–¹å‘   â”‚ TCP      â”‚ 21118/21118 â”‚ 0.0.0.0/0   â”‚ RustDesk â”‚
â”‚ å…¥æ–¹å‘   â”‚ TCP      â”‚ 21119/21119 â”‚ 0.0.0.0/0   â”‚ RustDesk â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


# æ‰©å±•

### ä¸ºä»€ä¹ˆrustdesk ç«¯å£è¦å¼€è¿™ä¹ˆå¤šå‘¢
ä¸‹é¢å°±æ˜¯è¯´æ˜ç«¯å£å«ä¹‰

è¿™äº›ç«¯å£æ˜¯ RustDesk è¿œç¨‹æ¡Œé¢æœåŠ¡çš„ä¸åŒç»„ä»¶æ‰€éœ€è¦çš„ï¼Œè®©æˆ‘è¯¦ç»†è§£é‡Šæ¯ä¸ªç«¯å£çš„ä½œç”¨ï¼š

## RustDesk ç«¯å£è¯¦è§£

### æ ¸å¿ƒæœåŠ¡ç«¯å£

```bash
21115 (TCP) - hbbs (Heart Beat & Signal Server)
â”œâ”€â”€ ä½œç”¨ï¼šä¿¡å·æœåŠ¡å™¨ï¼Œå¤„ç†è®¾å¤‡æ³¨å†Œå’Œè¿æ¥åè°ƒ
â”œâ”€â”€ åŠŸèƒ½ï¼šè®¾å¤‡å¿ƒè·³æ£€æµ‹ã€IDæ³¨å†Œã€è¿æ¥å»ºç«‹
â””â”€â”€ å¿…éœ€ï¼šæ˜¯ï¼ˆæ ¸å¿ƒæœåŠ¡ï¼‰

21116 (TCP + UDP) - hbbr (Heart Beat & Relay Server) 
â”œâ”€â”€ TCPï¼šä¸­ç»§æœåŠ¡å™¨æ§åˆ¶ç«¯å£
â”œâ”€â”€ UDPï¼šå®é™…çš„è¿œç¨‹æ¡Œé¢æ•°æ®ä¼ è¾“
â”œâ”€â”€ åŠŸèƒ½ï¼šå½“P2Pè¿æ¥å¤±è´¥æ—¶ï¼Œé€šè¿‡æœåŠ¡å™¨ä¸­ç»§æ•°æ®
â””â”€â”€ å¿…éœ€ï¼šæ˜¯ï¼ˆæ•°æ®ä¼ è¾“ï¼‰

21117 (TCP) - hbbs Web Console
â”œâ”€â”€ ä½œç”¨ï¼šWebç®¡ç†ç•Œé¢
â”œâ”€â”€ åŠŸèƒ½ï¼šé€šè¿‡æµè§ˆå™¨ç®¡ç†RustDeskæœåŠ¡å™¨
â””â”€â”€ å¿…éœ€ï¼šå¦ï¼ˆä»…ç®¡ç†éœ€è¦ï¼‰

21118 (TCP) - hbbs API
â”œâ”€â”€ ä½œç”¨ï¼šAPIæ¥å£æœåŠ¡
â”œâ”€â”€ åŠŸèƒ½ï¼šæä¾›REST APIï¼Œä¾›ç¬¬ä¸‰æ–¹åº”ç”¨è°ƒç”¨
â””â”€â”€ å¿…éœ€ï¼šå¦ï¼ˆä»…APIè°ƒç”¨éœ€è¦ï¼‰

21119 (TCP) - é¢å¤–æœåŠ¡ç«¯å£
â”œâ”€â”€ ä½œç”¨ï¼šå¤‡ç”¨ç«¯å£æˆ–ç‰¹å®šåŠŸèƒ½
â”œâ”€â”€ åŠŸèƒ½ï¼šå¯èƒ½ç”¨äºç‰¹æ®Šåè®®æˆ–å¤‡ç”¨è¿æ¥
â””â”€â”€ å¿…éœ€ï¼šè§†é…ç½®è€Œå®š
```

## ç«¯å£ä½¿ç”¨åœºæ™¯

### 1. åŸºç¡€è¿œç¨‹æ¡Œé¢è¿æ¥
```bash
# æœ€å°åŒ–é…ç½®åªéœ€è¦è¿™ä¸¤ä¸ªç«¯å£
21115/tcp  # è®¾å¤‡æ³¨å†Œå’Œä¿¡å·åè°ƒ
21116/tcp+udp  # æ•°æ®ä¼ è¾“ï¼ˆP2På¤±è´¥æ—¶çš„ä¸­ç»§ï¼‰
```

### 2. å®Œæ•´ç®¡ç†åŠŸèƒ½
```bash
21115/tcp  # æ ¸å¿ƒä¿¡å·æœåŠ¡
21116/tcp+udp  # æ•°æ®ä¸­ç»§æœåŠ¡  
21117/tcp  # Webç®¡ç†ç•Œé¢
21118/tcp  # APIæ¥å£
21119/tcp  # æ‰©å±•åŠŸèƒ½
```

## éªŒè¯ç«¯å£ä½¿ç”¨æƒ…å†µ

```bash
# 1. æŸ¥çœ‹ RustDesk è¿›ç¨‹å ç”¨çš„ç«¯å£
sudo netstat -tlnp | grep rust
sudo ss -tlnp | grep rust

# 2. æŸ¥çœ‹å…·ä½“ç«¯å£ç›‘å¬æƒ…å†µ
sudo lsof -i :21115
sudo lsof -i :21116
sudo lsof -i :21117
sudo lsof -i :21118
sudo lsof -i :21119

# 3. æŸ¥çœ‹ RustDesk æœåŠ¡çŠ¶æ€
sudo systemctl status rustdesk-hbbs
sudo systemctl status rustdesk-hbbr

# 4. æŸ¥çœ‹ RustDesk é…ç½®æ–‡ä»¶
find /etc -name "*rustdesk*" 2>/dev/null
find /opt -name "*rustdesk*" 2>/dev/null
```

## å®‰å…¨ä¼˜åŒ–å»ºè®®

### 1. æœ€å°åŒ–ç«¯å£å¼€æ”¾
å¦‚æœåªéœ€è¦åŸºæœ¬è¿œç¨‹æ¡Œé¢åŠŸèƒ½ï¼š
```bash
# åªå¼€æ”¾å¿…éœ€ç«¯å£
21115/tcp  # å¿…éœ€
21116/tcp+udp  # å¿…éœ€

# å…³é—­éå¿…éœ€ç«¯å£ï¼ˆå¦‚æœä¸éœ€è¦Webç®¡ç†ï¼‰
# 21117/tcp  # Webç®¡ç†ç•Œé¢
# 21118/tcp  # APIæ¥å£  
# 21119/tcp  # æ‰©å±•åŠŸèƒ½
```

### 2. é™åˆ¶æºIPè®¿é—®
```bash
# ä¸å»ºè®®å¯¹æ‰€æœ‰IPå¼€æ”¾ï¼Œå»ºè®®é™åˆ¶ç‰¹å®šIPæ®µ
# ä¾‹å¦‚åªå…è®¸å†…ç½‘è®¿é—®ï¼š
æºåœ°å€ï¼š192.168.0.0/16  # å†…ç½‘æ®µ
æºåœ°å€ï¼š10.0.0.0/8     # å†…ç½‘æ®µ
æºåœ°å€ï¼š172.16.0.0/12  # å†…ç½‘æ®µ

# æˆ–è€…åªå…è®¸ç‰¹å®šIPè®¿é—®ï¼š
æºåœ°å€ï¼šyour.trusted.ip.address/32
```

### 3. æ£€æŸ¥å®é™…éœ€æ±‚
```bash
# æŸ¥çœ‹ RustDesk é…ç½®ï¼Œç¡®è®¤å“ªäº›ç«¯å£çœŸæ­£éœ€è¦
cat /etc/rustdesk/config.toml 2>/dev/null || \
cat /opt/rustdesk/config.toml 2>/dev/null || \
find / -name "*.toml" -path "*rustdesk*" 2>/dev/null
```

## ç«¯å£æµ‹è¯•

```bash
# æµ‹è¯•ç«¯å£è¿é€šæ€§
telnet your-server-ip 21115
telnet your-server-ip 21116
telnet your-server-ip 21117
telnet your-server-ip 21118
telnet your-server-ip 21119

# æˆ–ä½¿ç”¨ nc å‘½ä»¤
nc -zv your-server-ip 21115-21119
```

**å»ºè®®**ï¼šå¦‚æœä½ åªæ˜¯ç”¨äºä¸ªäººè¿œç¨‹æ¡Œé¢ï¼Œå¯ä»¥è€ƒè™‘åªå¼€æ”¾ 21115 å’Œ 21116 ç«¯å£ï¼Œå…¶ä»–ç«¯å£å¯ä»¥æ ¹æ®å®é™…ä½¿ç”¨éœ€æ±‚å†å¼€æ”¾ã€‚åŒæ—¶å»ºè®®é™åˆ¶æºIPåœ°å€ï¼Œä¸è¦å¯¹å…¨ç½‘å¼€æ”¾ï¼ˆ0.0.0.0/0ï¼‰ã€‚

