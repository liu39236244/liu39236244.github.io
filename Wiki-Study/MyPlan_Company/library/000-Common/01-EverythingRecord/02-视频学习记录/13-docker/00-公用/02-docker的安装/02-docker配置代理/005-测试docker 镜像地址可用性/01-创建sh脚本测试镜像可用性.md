å¥½çš„ï¼Œæˆ‘æ¥å¸®ä½ å†™ä¸€ä¸ªç»¼åˆæµ‹è¯•è„šæœ¬ï¼Œæµ‹è¯•é•œåƒæºå¯ç”¨æ€§å’Œé•œåƒå¯ä¸‹è½½æ€§ï¼Œä½†ä¸å®é™…ä¸‹è½½ã€‚

```bash
# åˆ›å»ºç»¼åˆæµ‹è¯•è„šæœ¬
cat > docker_mirrors_test.sh << 'EOF'
#!/bin/bash

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# é•œåƒæºåˆ—è¡¨
mirrors=(
    "https://docker.mirrors.ustc.edu.cn|ä¸­ç§‘å¤§"
    "https://hub-mirror.c.163.com|ç½‘æ˜“"
    "https://docker.m.daocloud.io|DaoCloud"
    "https://dockerproxy.com|DockerProxy"
    "https://docker.nju.edu.cn|å—äº¬å¤§å­¦"
    "https://mirror.baidubce.com|ç™¾åº¦äº‘"
    "https://dockerhub.azk8s.cn|Azureä¸­å›½"
    "https://reg-mirror.qiniu.com|ä¸ƒç‰›äº‘"
)

# å¼€å‘ç»„ä»¶é•œåƒåˆ—è¡¨
dev_images=(
    "library/nginx:latest|Nginx WebæœåŠ¡å™¨"
    "library/redis:latest|Redis ç¼“å­˜æ•°æ®åº“"
    "library/mysql:8.0|MySQL å…³ç³»æ•°æ®åº“"
    "clickhouse/clickhouse-server:latest|ClickHouse åˆ—å¼æ•°æ®åº“"
    "starrocks/starrocks:latest|StarRocks åˆ†ææ•°æ®åº“"
    "library/postgres:latest|PostgreSQL æ•°æ®åº“"
    "library/mongo:latest|MongoDB æ–‡æ¡£æ•°æ®åº“"
    "library/elasticsearch:7.17.0|Elasticsearch æœç´¢å¼•æ“"
)

# å¤§æ•°æ®ç»„ä»¶é•œåƒåˆ—è¡¨
bigdata_images=(
    "apache/spark:latest|Apache Spark"
    "apache/hadoop:3|Apache Hadoop"
    "apache/kafka:latest|Apache Kafka"
    "apache/zookeeper:latest|Apache Zookeeper"
    "apache/flink:latest|Apache Flink"
    "apache/airflow:latest|Apache Airflow"
    "confluentinc/cp-kafka:latest|Confluent Kafka"
    "bitnami/spark:latest|Bitnami Spark"
    "jupyter/all-spark-notebook:latest|Jupyter Spark"
    "apache/superset:latest|Apache Superset"
    "grafana/grafana:latest|Grafana ç›‘æ§"
    "prom/prometheus:latest|Prometheus ç›‘æ§"
    "elastic/kibana:7.17.0|Kibana å¯è§†åŒ–"
    "apache/dolphinscheduler:latest|DolphinScheduler"
    "apache/doris:latest|Apache Doris"
)

# å‡½æ•°ï¼šæµ‹è¯•é•œåƒæºè¿é€šæ€§
test_mirror_connectivity() {
    local url=$1
    local name=$2
    
    echo -n "  æµ‹è¯• ${name} (${url}): "
    
    # æµ‹è¯•åŸºæœ¬è¿é€šæ€§
    if ! curl -s --connect-timeout 5 --max-time 10 "${url}" > /dev/null 2>&1; then
        echo -e "${RED}âŒ è¿æ¥å¤±è´¥${NC}"
        return 1
    fi
    
    # æµ‹è¯• Docker Registry API
    if curl -s --connect-timeout 5 --max-time 10 "${url}/v2/" | grep -q "registry" 2>/dev/null; then
        echo -e "${GREEN}âœ… API æ­£å¸¸${NC}"
        return 0
    else
        echo -e "${YELLOW}âš ï¸  è¿æ¥æˆåŠŸä½†APIå¼‚å¸¸${NC}"
        return 2
    fi
}

# å‡½æ•°ï¼šæµ‹è¯•é•œåƒæ˜¯å¦å­˜åœ¨ï¼ˆä¸ä¸‹è½½ï¼‰
test_image_exists() {
    local mirror_url=$1
    local image_path=$2
    local image_name=$3
    
    # æ„å»º manifest URL
    local manifest_url="${mirror_url}/v2/${image_path}/manifests/latest"
    
    # æµ‹è¯•é•œåƒ manifest æ˜¯å¦å­˜åœ¨
    if curl -s --connect-timeout 5 --max-time 10 -I "${manifest_url}" | grep -q "200 OK\|application/vnd.docker" 2>/dev/null; then
        return 0
    else
        return 1
    fi
}

# å‡½æ•°ï¼šæµ‹è¯•é•œåƒæºçš„é•œåƒå¯ç”¨æ€§
test_images_on_mirror() {
    local mirror_url=$1
    local mirror_name=$2
    local images_array=("$@")
    local images_array=("${@:3}")  # ä»ç¬¬3ä¸ªå‚æ•°å¼€å§‹æ˜¯é•œåƒæ•°ç»„
    
    echo -e "\n${BLUE}ğŸ“‹ æµ‹è¯• ${mirror_name} çš„é•œåƒå¯ç”¨æ€§ï¼š${NC}"
    
    local success_count=0
    local total_count=${#images_array[@]}
    
    for image_info in "${images_array[@]}"; do
        local image_path=$(echo "$image_info" | cut -d'|' -f1)
        local image_desc=$(echo "$image_info" | cut -d'|' -f2)
        
        echo -n "    ${image_desc}: "
        
        if test_image_exists "$mirror_url" "$image_path" "$image_desc"; then
            echo -e "${GREEN}âœ… å¯ç”¨${NC}"
            ((success_count++))
        else
            echo -e "${RED}âŒ ä¸å¯ç”¨${NC}"
        fi
    done
    
    echo -e "    ${YELLOW}ğŸ“Š æˆåŠŸç‡: ${success_count}/${total_count} ($(( success_count * 100 / total_count ))%)${NC}"
}

# ä¸»å‡½æ•°
main() {
    echo -e "${BLUE}ğŸ” Docker é•œåƒæºç»¼åˆæµ‹è¯•${NC}"
    echo "========================================"
    
    # 1. æµ‹è¯•é•œåƒæºè¿é€šæ€§
    echo -e "\n${YELLOW}ğŸ“¡ ç¬¬ä¸€æ­¥ï¼šæµ‹è¯•é•œåƒæºè¿é€šæ€§${NC}"
    available_mirrors=()
    
    for mirror_info in "${mirrors[@]}"; do
        url=$(echo "$mirror_info" | cut -d'|' -f1)
        name=$(echo "$mirror_info" | cut -d'|' -f2)
        
        if test_mirror_connectivity "$url" "$name"; then
            available_mirrors+=("$mirror_info")
        fi
    done
    
    echo -e "\n${GREEN}âœ… å¯ç”¨é•œåƒæºæ•°é‡: ${#available_mirrors[@]}/${#mirrors[@]}${NC}"
    
    if [ ${#available_mirrors[@]} -eq 0 ]; then
        echo -e "${RED}âŒ æ²¡æœ‰å¯ç”¨çš„é•œåƒæºï¼Œæµ‹è¯•ç»“æŸ${NC}"
        exit 1
    fi
    
    # 2. æµ‹è¯•å¼€å‘ç»„ä»¶é•œåƒ
    echo -e "\n${YELLOW}ğŸ› ï¸  ç¬¬äºŒæ­¥ï¼šæµ‹è¯•å¼€å‘ç»„ä»¶é•œåƒå¯ç”¨æ€§${NC}"
    for mirror_info in "${available_mirrors[@]}"; do
        url=$(echo "$mirror_info" | cut -d'|' -f1)
        name=$(echo "$mirror_info" | cut -d'|' -f2)
        test_images_on_mirror "$url" "$name" "${dev_images[@]}"
    done
    
    # 3. æµ‹è¯•å¤§æ•°æ®ç»„ä»¶é•œåƒ
    echo -e "\n${YELLOW}ğŸ“Š ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯•å¤§æ•°æ®ç»„ä»¶é•œåƒå¯ç”¨æ€§${NC}"
    for mirror_info in "${available_mirrors[@]}"; do
        url=$(echo "$mirror_info" | cut -d'|' -f1)
        name=$(echo "$mirror_info" | cut -d'|' -f2)
        test_images_on_mirror "$url" "$name" "${bigdata_images[@]}"
    done
    
    # 4. ç”Ÿæˆæ¨èé…ç½®
    echo -e "\n${BLUE}ğŸ’¡ æ¨èçš„é•œåƒæºé…ç½®ï¼š${NC}"
    echo "{"
    echo '  "registry-mirrors": ['
    
    local first=true
    for mirror_info in "${available_mirrors[@]}"; do
        url=$(echo "$mirror_info" | cut -d'|' -f1)
        if [ "$first" = true ]; then
            echo "    \"$url\","
            first=false
        else
            echo "    \"$url\","
        fi
    done
    
    echo '  ]'
    echo "}"
    
    # 5. ç”Ÿæˆæµ‹è¯•æ€»ç»“
    echo -e "\n${BLUE}ğŸ“ˆ æµ‹è¯•æ€»ç»“ï¼š${NC}"
    echo "- æ€»é•œåƒæºæ•°é‡: ${#mirrors[@]}"
    echo "- å¯ç”¨é•œåƒæºæ•°é‡: ${#available_mirrors[@]}"
    echo "- æµ‹è¯•çš„å¼€å‘ç»„ä»¶: ${#dev_images[@]} ä¸ª"
    echo "- æµ‹è¯•çš„å¤§æ•°æ®ç»„ä»¶: ${#bigdata_images[@]} ä¸ª"
    
    echo -e "\n${GREEN}âœ¨ æµ‹è¯•å®Œæˆï¼${NC}"
}

# å¿«é€Ÿæµ‹è¯•å‡½æ•°ï¼ˆåªæµ‹è¯•è¿é€šæ€§ï¼‰
quick_test() {
    echo -e "${BLUE}âš¡ å¿«é€Ÿè¿é€šæ€§æµ‹è¯•${NC}"
    echo "===================="
    
    for mirror_info in "${mirrors[@]}"; do
        url=$(echo "$mirror_info" | cut -d'|' -f1)
        name=$(echo "$mirror_info" | cut -d'|' -f2)
        test_mirror_connectivity "$url" "$name"
    done
}

# æ£€æŸ¥å‚æ•°
case "${1:-full}" in
    "quick"|"-q"|"--quick")
        quick_test
        ;;
    "full"|"-f"|"--full"|"")
        main
        ;;
    "help"|"-h"|"--help")
        echo "ç”¨æ³•: $0 [é€‰é¡¹]"
        echo "é€‰é¡¹:"
        echo "  quick, -q, --quick    åªæµ‹è¯•é•œåƒæºè¿é€šæ€§"
        echo "  full, -f, --full      å®Œæ•´æµ‹è¯•ï¼ˆé»˜è®¤ï¼‰"
        echo "  help, -h, --help      æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯"
        ;;
    *)
        echo "æœªçŸ¥é€‰é¡¹: $1"
        echo "ä½¿ç”¨ '$0 help' æŸ¥çœ‹å¸®åŠ©"
        exit 1
        ;;
esac
EOF

# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x docker_mirrors_test.sh

# åˆ›å»ºä¸€ä¸ªç®€åŒ–ç‰ˆæœ¬çš„æµ‹è¯•è„šæœ¬
cat > quick_mirror_test.sh << 'EOF'
#!/bin/bash

# ç®€åŒ–ç‰ˆé•œåƒæºæµ‹è¯•
mirrors=(
    "docker.mirrors.ustc.edu.cn|ä¸­ç§‘å¤§"
    "hub-mirror.c.163.com|ç½‘æ˜“"
    "docker.m.daocloud.io|DaoCloud"
    "dockerproxy.com|DockerProxy"
    "docker.nju.edu.cn|å—äº¬å¤§å­¦"
    "mirror.baidubce.com|ç™¾åº¦äº‘"
    "dockerhub.azk8s.cn|Azureä¸­å›½"
    "reg-mirror.qiniu.com|ä¸ƒç‰›äº‘"
)

echo "ğŸ” Docker é•œåƒæºå¿«é€Ÿæµ‹è¯•"
echo "========================"

available_count=0
for mirror_info in "${mirrors[@]}"; do
    url=$(echo "$mirror_info" | cut -d'|' -f1)
    name=$(echo "$mirror_info" | cut -d'|' -f2)
    
    echo -n "æµ‹è¯• $name: "
    if curl -s --connect-timeout 3 "https://$url/v2/" > /dev/null 2>&1; then
        echo "âœ… å¯ç”¨"
        ((available_count++))
    else
        echo "âŒ ä¸å¯ç”¨"
    fi
done

echo ""
echo "ğŸ“Š ç»“æœ: $available_count/${#mirrors[@]} ä¸ªé•œåƒæºå¯ç”¨"

# æµ‹è¯•å‡ ä¸ªå¸¸ç”¨é•œåƒçš„å­˜åœ¨æ€§
if [ $available_count -gt 0 ]; then
    echo ""
    echo "ğŸ§ª æµ‹è¯•å¸¸ç”¨é•œåƒå¯ä¸‹è½½æ€§ï¼š"
    test_images=("nginx" "redis" "mysql")
    
    for image in "${test_images[@]}"; do
        echo -n "  $image: "
        if timeout 10 docker manifest inspect "$image:latest" > /dev/null 2>&1; then
            echo "âœ… å¯ä¸‹è½½"
        else
            echo "âŒ æ— æ³•è·å–"
        fi
    done
fi
EOF

chmod +x quick_mirror_test.sh

echo "âœ… å·²åˆ›å»ºæµ‹è¯•è„šæœ¬ï¼"
echo ""
echo "ä½¿ç”¨æ–¹æ³•ï¼š"
echo "1. å®Œæ•´æµ‹è¯•: ./docker_mirrors_test.sh"
echo "2. å¿«é€Ÿæµ‹è¯•: ./docker_mirrors_test.sh quick"
echo "3. ç®€åŒ–æµ‹è¯•: ./quick_mirror_test.sh"
echo ""
echo "ç°åœ¨è¿è¡Œå¿«é€Ÿæµ‹è¯•ï¼š"
./quick_mirror_test.sh
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š

1. **æµ‹è¯•é•œåƒæºè¿é€šæ€§** - æ£€æŸ¥æ¯ä¸ªé•œåƒæºæ˜¯å¦å¯ä»¥è®¿é—®
2. **æµ‹è¯•å¼€å‘ç»„ä»¶** - æ£€æŸ¥ nginxã€redisã€mysqlã€clickhouseã€starrocks ç­‰æ˜¯å¦å¯ä¸‹è½½
3. **æµ‹è¯•å¤§æ•°æ®ç»„ä»¶** - æ£€æŸ¥ sparkã€hadoopã€kafkaã€flink ç­‰å¤§æ•°æ®ç›¸å…³é•œåƒ
4. **ä¸å®é™…ä¸‹è½½** - åªæ£€æŸ¥ manifest ä¿¡æ¯ï¼Œä¸ä¸‹è½½é•œåƒå†…å®¹
5. **ç”Ÿæˆæ¨èé…ç½®** - æ ¹æ®æµ‹è¯•ç»“æœç”Ÿæˆå¯ç”¨çš„é•œåƒæºé…ç½®
6. **å½©è‰²è¾“å‡º** - ä½¿ç”¨é¢œè‰²åŒºåˆ†æˆåŠŸ/å¤±è´¥çŠ¶æ€

è¿è¡Œæ–¹å¼ï¼š
- `./docker_mirrors_test.sh` - å®Œæ•´æµ‹è¯•
- `./docker_mirrors_test.sh quick` - åªæµ‹è¯•è¿é€šæ€§
- `./quick_mirror_test.sh` - ç®€åŒ–ç‰ˆæµ‹è¯•

è¿™æ ·ä½ å°±èƒ½çŸ¥é“å“ªäº›é•œåƒæºå¯ç”¨ï¼Œä»¥åŠèƒ½ä¸‹è½½å“ªäº›å¼€å‘å’Œå¤§æ•°æ®ç»„ä»¶äº†ï¼