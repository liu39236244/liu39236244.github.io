# 两小时临时学习activity


[  bilibli 工作流 两小时让你重新看懂activiti工作流，从入门到入坟一次到位！](https://www.bilibili.com/video/BV1ji4y1k7CD/?p=2&vd_source=c35490de6888f6b2eaf6af9798d41a06)

## BPMN介绍

![](assets/009/21/01/001/01-1668654278084.png)


![](assets/009/21/01/001/01-1668654722187.png)



### activity 流程


![](assets/009/21/01/001/01-1668654794854.png)


### activity 搭建

![](assets/009/21/01/001/01-1668657336441.png)


![](assets/009/21/01/001/01-1668657422513.png)


![](assets/009/21/01/001/01-1668657536703.png)


### 表结构


![](assets/009/21/01/001/01-1668657871964.png)



![](assets/009/21/01/001/01-1668658119743.png)


## 搭建开发环境 创建流程定义


![](assets/009/21/01/001/01-1668658360603.png)




### 四个核心对象


![](assets/009/21/01/001/01-1668658447955.png)


### 创建流程BPMN 文件


### 乱码问题处理

![](assets/009/21/01/001/01-1668658813572.png)

![](assets/009/21/01/001/01-1668658780323.png)


### 一个bpmn 文件中其实本质是一个xml文件

 一个bpmn 文件中其实本质是一个xml文件，且一个xml中可以创建多个流程，只不过正常开发只会创建一个


![](assets/009/21/01/001/01-1668659012310.png)


### 流程图转为业务逻辑图

![](assets/009/21/01/001/01-1668659285621.png)

![](assets/009/21/01/001/01-1668659253451.png)


### 部署流程图原理

其实就是吧对应的xml  png 等存到数据表中

![](assets/009/21/01/001/01-1668661031566.png)

![](assets/009/21/01/001/01-1668661257643.png)

![](assets/009/21/01/001/01-1668661237861.png)



## 流程初体验

### 批量部署bpmn 流程怎么弄呢

吧bpmn 以及png 打成压缩包


![](assets/009/21/01/001/01-1668661304688.png)



![](assets/009/21/01/001/01-1668661590548.png)


### 模拟员工请假走一次流程


![](assets/009/21/01/001/01-1668661670968.png)


### 查询当前人待执行的任务


![](assets/009/21/01/001/01-1668661785473.png)



### 注意流程id 与任务id 区别

![](assets/009/21/01/001/01-1668662080287.png)



### 查询当前流程下有那些实例正在跑着

![](assets/009/21/01/001/01-1668662201874.png)


### 尝试删除一个流程


报错：因为目前有流程实例跑的话是不能删的

![](assets/009/21/01/001/01-1668662282248.png)




### 尝试下载流程定义时候的一些附件


![](assets/009/21/01/001/01-1668662425089.png)

### 总结

![](assets/009/21/01/001/01-1668662791192.png)





## 流程挂起预激活 （activity 进阶）



![](assets/009/21/01/001/01-1668666007687.png)


![](assets/009/21/01/001/01-1668666075305.png)




### 添加 业务的key 到 activity的表中

![](assets/009/21/01/001/01-1668666320398.png)



### bussiness key  注意 是varchar 255 所以 如果传json 的话注意长度


![](assets/009/21/01/001/01-1668666696846.png)

### 获取对应流程的所有实例对象

![](assets/009/21/01/001/01-1668666820799.png)


### 挂起、激活流程实例


![](assets/009/21/01/001/01-1668666881448.png)

挂起以后尝试去操作对应的定义下的一个实例看看是否可以进行操作(当然是不可以的啦)


![](assets/009/21/01/001/01-1668667097678.png)

### 每一个流程实例的某一步(就是每个人物)可以挂起吗

不可以！只能定义、实例可以挂起



## 流程变量

![](assets/009/21/01/001/01-1668667705873.png)



### 启动一个流程多个方法的重载，有个带map的参数，其实更多用于变量控制 表达式

![](assets/009/21/01/001/01-1668667873385.png)


### 流程变量的作用域

#### global local 

每个实例的流程变量会一直传下去，如果某个任务改了这个参数就会被覆盖

![](assets/009/21/01/001/01-1668667943873.png)


### 流程变量的使用

![](assets/009/21/01/001/01-1668668049704.png)


### 出差申请流程


![](assets/009/21/01/001/01-1668668073571.png)

流程图中  ${assignee0}  这种的其实就是流程变量

![](assets/009/21/01/001/01-1668668163128.png)


![](assets/009/21/01/001/01-1668668229664.png)

![](assets/009/21/01/001/01-1668668887442.png)


### 来看一个实例


![](assets/009/21/01/001/01-1668668264105.png)


### 设置Global变量的方式


#### 1 启动任务时、2 任务办理时

![](assets/009/21/01/001/01-1668668921793.png)

#### 3 通过当前流程实例设置

![](assets/009/21/01/001/01-1668669301210.png)


#### 4 通过当前任务


![](assets/009/21/01/001/01-1668669469548.png)


 * 注意事项

flow 其实就是先拖进bpmn中的 步骤就是小的

![](assets/009/21/01/001/01-1668669604652.png)




### 设置local 变量的方式

可以多个地方设置

#### 任务办理时设置

![](assets/009/21/01/001/01-1668669886539.png)


#### 通过当前任务设置


![](assets/009/21/01/001/01-1668669992139.png)


## 网关


 控制流程流程流向的重要组件，通常结合流程变量是使用,有四种

![](assets/009/21/01/001/01-1668670277683.png)

 ### 排他网关 ExclusiveGateway


 ![](assets/009/21/01/001/01-1668670153941.png)


![](assets/009/21/01/001/01-1668670311292.png)


#### 代码走读，流程先定义

![](assets/009/21/01/001/01-1668670718296.png)

![](assets/009/21/01/001/01-1668670443132.png)

#### 执行对应任务使任务进行完成tom

![](assets/009/21/01/001/01-1668670606900.png)

#### 执行对应任务使任务进行完成jerry

![](assets/009/21/01/001/01-1668670646908.png)


#### 总结

排他网关，在多个路线中只能有个，如果都不满足那就会异常


### 并行网关 ParallelGateway

![](assets/009/21/01/001/01-1668670828689.png)

与其他网关主要区别是，并行网关不会解析条件。即使顺序流中定义了条件，也会被忽略。

另外并行网关后面也需要有一个并行网关进行聚合。

![](assets/009/21/01/001/01-1668670969426.png)


### 包含网关 inclusiveGateway


![](assets/009/21/01/001/01-1668671486494.png)

![](assets/009/21/01/001/01-1668671702629.png)


### 事件网关(用的也不多)

![](assets/009/21/01/001/01-1668672061615.png)


![](assets/009/21/01/001/01-1668672103296.png)


## 任务分配

分配任务负责人


![](assets/009/21/01/001/01-1668672175432.png)


![](assets/009/21/01/001/01-1668672198036.png)


![](assets/009/21/01/001/01-1668672283375.png)

![](assets/009/21/01/001/01-1668672336903.png)


## 任务分配 组任务


![](assets/009/21/01/001/01-1668672392106.png)

![](assets/009/21/01/001/01-1668672453601.png)

![](assets/009/21/01/001/01-1668672563800.png)

候选人这里查出来就为null，且 对应候选人是无法直接完成的，需要先主动认领，这一点很关键

### 根据候选人查询任务

![](assets/009/21/01/001/01-1668672889583.png)


### 拾取任务，把候选人换成责任人

![](assets/009/21/01/001/01-1668672987549.png)


任务负责人就已经换了，就成功了

![](assets/009/21/01/001/01-1668673089745.png)


### 加入认领的人无法处理任务怎么办，那就有任务退还功能

关键是设置 assign 为null 即可,

![](assets/009/21/01/001/01-1668673173688.png)

### 同样如果不想直接归还而是想直接给某人，也可以进行交接给某人

![](assets/009/21/01/001/01-1668673274344.png)


* 注意，其实这里交接的时候 activity 在这一步并没有进行严格的限制，所以这里可以咱们自己做的时候进行判断


![](assets/009/21/01/001/01-1668673455305.png)





## 先看下与spring整合


其实activity 内部已经进行了整合，

![](assets/009/21/01/001/01-1668673593286.png)


![](assets/009/21/01/001/01-1668673637624.png)




![](assets/009/21/01/001/01-1668673772698.png)




### 实例

![](assets/009/21/01/001/01-1668673830353.png)


为: true(默认) 有的话就不创建了。 没有的话就创建

![](assets/009/21/01/001/01-1668673933624.png)


## activity 元 springboot整合 

### 引入依赖，配置 yml 文件即可

![](assets/009/21/01/001/01-1668674046033.png)


![](assets/009/21/01/001/01-1668674117603.png)

![](assets/009/21/01/001/01-1668674131895.png)

### 使用方式，直接 注入即可



![](assets/009/21/01/001/01-1668674180314.png)


### 启动一个实例


![](assets/009/21/01/001/01-1668674210235.png)


![](assets/009/21/01/001/01-1668674232563.png)


#### 直接启动一个实例

![](assets/009/21/01/001/01-1668674280225.png)

这里你会发现不用部署bpmn流程也能启动一个实例，那是因为springboot 整合以后自动会帮你部署 对应文件下的bpmn文件

![](assets/009/21/01/001/01-1668674311274.png)


### 查看配置

![](assets/009/21/01/001/01-1668674435049.png)

也可以配置bpmn 对应的目录

![](assets/009/21/01/001/01-1668674451951.png)



## 其实idea 的插件并不是最终的选择， 实际还有个angularjs 的一个前端的工具



而且其实有很多网上整合过的

![](assets/009/21/01/001/01-1668674689114.png)