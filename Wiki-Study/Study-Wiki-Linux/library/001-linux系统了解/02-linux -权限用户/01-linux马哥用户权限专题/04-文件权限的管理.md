# 文件权限的管理

* 原地址：https://www.bilibili.com/video/BV1Wb411V7XL?p=5


## 文件权限


![](assets/001/02/01/04-1616827949312.png)


### 一个文件的访问可以分为三类人

```
1. 第一类所属用户：文件所属用户，在第三位，标识这个文件的所属用户是谁
2. 第二类文件所属用户的主组：就是文件所属组，如果不属于文件所属用户，那么如果跟文件所属用户在同一个组也会有对应的访问权限；
3. 第三类既不是文件所属用户，也不是文件所属用户同一个组的人；

三类用户对文件的操作权限由大到小依次递减 1>2>3 
```


![](assets/001/02/01/04-1616828166765.png)


### 那么有哪三种文件权限呢


Linux常见的文件类型有：普通文件、目录文件、字符设备文件和块设备文件、符号链接文件等，其中：

    普通文件的文件权限第一个字符为“-”
    目录文件的文件权限第一个字符为“d”
    字符设备文件的文件权限第一个字符为“c”；块设备文件的文件权限第一个字符为“b”
    符号链接文件的文件权限第一个字符为“s”

```
1. r :read, 读 ； 
    什么类型适合：[文本文件]
2. w :write，写
     什么类型适合：[文本文件]
3. x :excute ，执行
     什么类型适合：[程序(二进制、脚本)]


    
```

一个人如果要想知道拥有的权限
<font color='red'>按照 1. 文件所有者 2. 所属组  3. other 其他人的权限 ；  这种顺序执行的 </font>


![](assets/001/02/01/04-1616828769732.png)


> 示例1 ：将wang 账号添加到root 组中查看不同情况下的权限描述

* 1 查看wang 对 /etc/shadow 文件的权限

![](assets/001/02/01/04-1616828921797.png)

* 2 wang 添加到root

![](assets/001/02/01/04-1616828971414.png)

* 3 清空wang 的附加组

-- 设置权限

* 4 准备文件

![](assets/001/02/01/04-1616829178286.png)


* 5 读取文件查看（可以）

![](assets/001/02/01/04-1616829221797.png)


* 6 查看写权限 （不可以）


![](assets/001/02/01/04-1616829257501.png)


## 修改文件的命令

### chmod 命令

命令格式：chmod  who  操作  权限  文件 


![](assets/001/02/01/04-1616829395755.png)

```
who: 
    u: 用户所有者
    g: 所属组
    o: 其他人

操作：
    +:增加
    -:减少
    =:覆盖

权限：
    r:读
    w:写
    x:执行
```


<font color='red'>注意点：</font>

1 不能外人权限比自己权限要大！如下案例，other 的权限比自己权限还要大，肯定不符合常理！

![](assets/001/02/01/04-1616830851250.png)

2 可以只给写权限不给读权限，这种情况，你如果去编辑的话是看不到任何内容的；但是可以追加内容;



![](assets/001/02/01/04-1616831137196.png)

3 但是写权限不能删除文件；

那怎样才可以删呢，就是用户对文件所在目录有 写权限，就可以删除目录下的文件了！ 因为删除文件，就需要对文件目录 connent 有写权限；

![](assets/001/02/01/04-1616831246621.png)

所以就算你对文件有最大的权限 rwx，你都不一定能删除这个文件

![](assets/001/02/01/04-1616831491756.png)


#### 读写权限

> 1示例 ：将f1 文件添加 other 其他人拥有写权限


![](assets/001/02/01/04-1616829598845.png)


* 1将 wang 添加到root组中：

![](assets/001/02/01/04-1616829957117.png)

下面是目前文件的权限描述：

![](assets/001/02/01/04-1616829905694.png)


> 2示例：将所有者权限都去掉；所属组只分配读权限；其他人只有读写权限；

* 命令如下；

![](assets/001/02/01/04-1616830235957.png)


但是注意： root 就真的啥权限都没了吗？ no ！ root 想看照样能看，权限是给普通用户设置的，对root ，人家可不吃这套


![](assets/001/02/01/04-1616830323540.png)

> 3示例: 修改f1 所有者



![](assets/001/02/01/04-1616830433204.png)

那么wang 将对f1 读权限都没(表面上)

![](assets/001/02/01/04-1616830492588.png)


![](assets/001/02/01/04-1616830623532.png)


#### 执行权限



> 1 将 /bin/cat  文件的执行权限给去掉，那么即使是root 也不能执行 cat 命令查看文件了！(这一点与 读、写权限不一样，执行权限是受 权限描述的)因为执行很重要！重要！要！

![](assets/001/02/01/04-1616831701563.png)

> 2 比如将 /bin/rm 的执行权限去除


![](assets/001/02/01/04-1616831854090.png)

root 也没有rm 权限了

```
上述命令扩展：
    a-x 
    -x 
    两者都一样，都是之所有人。
```




### chown : 修改文件所有者

chown 用户名  文件名
chown -R 用户名  文件名
chown -R 用户名  目录名
<font color='red'>chown -R 用户名  /   相当于 rm -rf /* </font> chmod 也类似 ，带 R 的都要谨慎

注意：将自己的文件所有者改为其他人，是不允许的！


![](assets/001/02/01/04-1616830724957.png)



## 目录权限

其实目录也是文件，只不过比较特殊

```
r read ： 可浏览文件列表（只能看到文件名） 
    所以一般给一个人一个目录的  rx 两个权限，用户才可以正常访问目录
w write
    可创建、删除文件(但是也同时需要x权限配合，否则cd都不能用，还怎么创建删除内部文件)
x excute cd 访问目录内的文件  cat/ll操作一些文件
    没有x: 就没有cd 进入目录的权限；也没有删除文件夹中文件的权限；
```




### 模式法设置 权限 


> 1 案例


### 写权限（需要配合x）控制文件删除、创建

* 1 先创建一个dir 目录

![](assets/001/02/01/04-1616832111349.png)


* 2 将wang 从root组中删除

![](assets/001/02/01/04-1616832157555.png)

* 3 dir 中copy俩文件

![](assets/001/02/01/04-1616832220371.png)


* 4 切换wang账号，查看目录结构

![](assets/001/02/01/04-1616832259155.png)


* 5 执行一下读、删除 操作

![](assets/001/02/01/04-1616832331811.png)

可知；能看不能删（因为wang 对 dir 目录没有写权限，所以不能删除里面的文件）

### 去掉读权限：看不到文件夹中文件描述，但是能盲看

* 6 切回root 去掉其他人对 dir 目录的 r 权限


![](assets/001/02/01/04-1616832427140.png)


* 7 可以看到，ll 查看不到dir中的文件，但是可以cat 查看里面的文件内容（前提你得知道有哪些文件）



![](assets/001/02/01/04-1616832555667.png)


可以看 文件的描述

![](assets/001/02/01/04-1616832584835.png)

<font color='red'>且 你在 ll 或者 cat 的时候 tab 命令提示也是不可用的！ </font>


### 只读权限

* 8 改为只读权限给其他人

![](assets/001/02/01/04-1616832979964.png)


![](assets/001/02/01/04-1616833108587.png)


![](assets/001/02/01/04-1616833156492.png)

### 读、执行权限

* 9 给目录 读、执行 权限


![](assets/001/02/01/04-1616833352716.png)

f2 文件只有读权限也可以进行删除

![](assets/001/02/01/04-1616833736883.png)


### 只给目录 w 权限，则也是不能删除目录下文件的

* 10 只给 w 权限，则文件夹内部的文件也是不能删除的



![](assets/001/02/01/04-1616834712274.png)


### 递归操控权限

* 11 dir目录中创建子目录，使用递归赋予 内部所有文件、文件夹权限



![](assets/001/02/01/04-1616834931218.png)

![](assets/001/02/01/04-1616835008554.png)

包括 dir 目录的执行权限也给去了


![](assets/001/02/01/04-1616835033842.png)


* 12 再全部都递归加上 wx 权限

![](assets/001/02/01/04-1616835117314.png)


但是这种方式是很危险的，因为把文件夹下面所有的文件也都加上了 x 权限；文件的x 权限可是很危险的


所以去掉：chmod -R a-wx dir/

### 递归中 大写 x 权限意义

* 13 所以 X 大写的，就是加权限的时候，排除掉文件，只递归给文件夹内部的文件夹 给上x权限，文件则不给；

![](assets/001/02/01/04-1616835315331.png)

* 14 但是如果目录中某些文件已经拥有 x 权限的

![](assets/001/02/01/04-1616835390754.png)


![](assets/001/02/01/04-1616835502020.png)

### copy 权限到另一个文件

* 15 参考权限设置其他文文件权限

reference ： 将 dir/wang1 的权限设置的跟 f2文件的权
限一样

![](assets/001/02/01/04-1616835610947.png)




## 权限数字法

格式：chmod 数字 文件名

其实就相当于每位有值就是1，转为10进制

![](assets/001/02/01/04-1616836244680.png)


r: 4
w: 2
x: 1

![](assets/001/02/01/04-1616836219739.png)


文件的权限 ：奇数说明有执行权限；偶数 没有执行权限

* 1 如图

![](assets/001/02/01/04-1616836329625.png)


## 修改文件组

![](assets/001/02/01/04-1616836568834.png)


### 一次性修改所有者与所属组

![](assets/001/02/01/04-1616836616755.png)

* . 省略

用户. :则表示将文件所属用户、所属组都改为 指定用户


![](assets/001/02/01/04-1616836638266.png)

.后面有值，则只修改所属组

![](assets/001/02/01/04-1616836707458.png)


* ： 冒号也行

![](assets/001/02/01/04-1616836756177.png)


## 案例

### 案例1

不小心删除了 mage的家目录，如何恢复


![](assets/001/02/01/04-1616837204290.png)



![](assets/001/02/01/04-1616837514057.png)

![](assets/001/02/01/04-1616837559361.png)



![](assets/001/02/01/04-1616837605824.png)


![](assets/001/02/01/04-1616837713137.png)