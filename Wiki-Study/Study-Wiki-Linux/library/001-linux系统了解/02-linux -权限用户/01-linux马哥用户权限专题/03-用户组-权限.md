# 用户组-权限


## 前言



在日常开发过程中，linux 系统进行操作的时候，肯定是用的不同的用户，因为这样才能更好控制每个用户的权限；如果都用root 用户 那肯定会有很多问题的。


### 介绍安全3A

> 3A 安全机制

* 1 Authentication :认证 

你比如手机的指纹，电脑的账户民密码，虹膜解锁等等

* 2  Authorization:授权
    比如删除等操作，

* 3  Accouting|Audition :审计

    删了库你不得去查到低谁干的



### 用户User

* 1  令牌token,identity

![](assets/001/02/01/03-1615125952777.png)
        
* 2 Linux用户 ：Username/UID

* 3 管理员：root,0  ： 一般root id 为 0 

* 4 普通用户： 1-65535

但是 centos6 普通用户 id500开始 , centos7普通用户是1000开始

    系统用户：1-499 ， 1-999 （Centos7）
        对守护进程获取资源进行权限分配，给系统一些软件使用的；你比如构建nginx 服务，那么这些1-499  1-999 这些id 就从这里面取，给系统使用，并不是给咱们人用的
    登录用户：500+,1000+(Centos7)
        交互式登录


### 用户组


* 1 Linux组 Groupname/GID

* 3 管理员组 ： root,0 
    当然用户与组名 是可以有相同的，其实你在linux 中创建一个账号的时候，系统会默认也创建一个跟用户名同样的私有组，并把该用户加入进去。win 中则创建用户只是创建用户

* 4 普通组：
    系统组： 1-499 ， 1-999 （centos7）
    普通组： 500+ ， 1000+ （centos7）

> 1 就好比windows 系统中 可以用命令 ：net user 创建用户


![](assets/001/02/01/03-1615126795950.png)


win-组列表

![](assets/001/02/01/03-1615126843197.png)

win-中创建用户，则会加入到默认users组当中，win中是不允许同名的用户与组 这点是与linux 不一样的

![](assets/001/02/01/03-1615127347657.png)

win-删除用户：net user 用户名 /del, 删除

![](assets/001/02/01/03-1615127471308.png)


如果现在有个文件想要给张三 。李四授权可以命令挨个给权限，但是如果以后有更多用户加入进来那肯定也麻烦，所以用到组


## 安全上下文

> 1 linux 安全上下文

    运行中的程序：进程（process）
    以进程发起者的身份运行：
        root:/bin/cat
        mage:/bin/cat
    
> 2 进程所能访问资源的权限取决于进程的运行者的身份

![](assets/001/02/01/03-1615127911986.png)


> 3 累计权限：就是一个用户如果在多个组，而每个组对某个文件权限一样，那么则会累计多个组的权限，相当于取并集


![](assets/001/02/01/03-1615128048960.png)


## 组的类别

> 1 Linux 组的类别

    用户的主要组（primary group） 主组，必须要有一个主组，默认新增加的账户对应的组就是用户的主组，也可以设置为其他组作为主组
        用户必须属于一个且只有一个主组
        祖名同用户名，且仅包含一个用户，私有组
    用户的附加组(supplementary group)
        一个用户可以属于零个或者多个附加组
    



主组在什么地方用到呢？

![](assets/001/02/01/03-1615128609092.png)

![](assets/001/02/01/03-1615128552935.png)


> 2 查看用户组信息

![](assets/001/02/01/03-1615128825905.png)



## 用户和组的配置文件


> 1 Linux 用户和组的主要配置文件：

    /etc/passwd : 用户以及其属性信息 (名称、UID、主组ID等)
    /etc/group: 组及其属性信息
    /etc/shadow: 用户密码以及其相关属性
    /etc/gshadow:组密码以及其相关属性

## 下面是 /etc/passwd 文件

> 2 看下 /etc/passwd 文件 

![](assets/001/02/01/03-1615129104496.png)


* 这里放上一个man 命令使用的博客地址[man 使用](https://www.cnblogs.com/chenmingjun/p/8352478.html)

![](assets/001/02/01/03-1615129293462.png)

列出passwd 文件的说明，放口令的文件，但是以前是方口令，但是普通用户都能访问得到的文件，那肯定不安全

![](assets/001/02/01/03-1615129556685.png)

存储格式是冒号隔开的7项


![](assets/001/02/01/03-1615131253439.png)

![](assets/001/02/01/03-1615131218875.png)


> 3 打开文件 


### 第二位用户密码

查看 

![](assets/001/02/01/03-1615130016501.png)


下面是 将文件中口令显示出来（当然是加密的）

![](assets/001/02/01/03-1615129896677.png)

还是改回去比较好

![](assets/001/02/01/03-1615129950145.png)




### 第三位用户id 

 第三位是用户id ，这里也说明了 ，root 用户id 是0 ，所以假设你把王账号的用户id 设置为 0 ，吧root 用户id 设置为 非零，（改过之后需要重新
登录） 那么是不是身份就能改变了？（是的！是的！是的！）修改过后身份就改变了

<font color='red'>而且可以有多个用户id为0 ，只要userid 为0 那么就是管理员！！！</font>

但是要注意，如果都改为0 ，假设用底下的 wang 账号登录了。那么会显示配置文件中最上面id 为0 的用户名字，你用普通用户登录，但是whoami 就是root了 

![](assets/001/02/01/03-1615130572396.png)


* 但是如果改文件 改坏了，比如没有任何一个用户id为0 ，就是没有管理员，那么就会登录上了。

但是可以用单用户模式进行修改；

> 3 修改配置文件错误怎么办，单用户模式 修改 /etc/passwd

* 直接修改肯定是不行的

![](assets/001/02/01/03-1615130902047.png)

* 执行之后就可以修改了，然后就把改坏的再改回来

![](assets/001/02/01/03-1615130931212.png)


### 第四位 用户所属组id

第四位是用户所属组id 

### 第五位是用户描述

第五位就是用户的描述信息，root 用户可能这里就是 root 字样表示为root 如果想手动添加描述可以用命令 ：chfn wang 

![](assets/001/02/01/03-1615131390472.png)

![](assets/001/02/01/03-1615131434274.png)

也可以直接用finger 查看用户信息

![](assets/001/02/01/03-1615131600497.png)

![](assets/001/02/01/03-1615131512301.png)


### 第六位 家目录


![](assets/001/02/01/03-1615131668291.png)

修改家目录如果目录不存在，则登陆之后会在 根目录

![](assets/001/02/01/03-1615132309255.png)

在把家目录换回正常，提示符也随正常了。那就是因为用户家目录其实对应的还有相应的配置文件

![](assets/001/02/01/03-1615132050986.png)

* 那么如果就是想修改怎么办


![](assets/001/02/01/03-1615132530917.png)

![](assets/001/02/01/03-1615132870878.png)
![](assets/001/02/01/03-1615132814913.png)


* 命令其实是吧 /etc/ 下所有的文件都复制过去了

删除刚才的复制的，重新创建给权限；命令该怎么写？    

![](assets/001/02/01/03-1615132915000.png)

命令： 
cp -r /etc/skel/.[`.]* /data/wang 

![](assets/001/02/01/03-1615132981260.png)


### 第七位 shell类型 

![](assets/001/02/01/03-1615215040727.png)

* 修改用户shell 类型 ，一般 /etc/passwd 文件修改是可以起到作用，但是一般不介意直接修改改文件。你就比如最后shell ，就可以用 专有命令修改


![](assets/001/02/01/03-1615215607455.png)

登录wang 账号 查看shell ：echo $SHELL

![](assets/001/02/01/03-1615216161086.png)


![](assets/001/02/01/03-1615216270695.png)

* nologin 类型shell ，如果设置为此 shell类型 ，那么用户就不能登录了

![](assets/001/02/01/03-1615216387966.png)

![](assets/001/02/01/03-1615216411045.png)

* 此时已经登录不上系统了 


![](assets/001/02/01/03-1615216465316.png)

即使是su 切换用户 ，也不行

![](assets/001/02/01/03-1615216483765.png)

我在切换回来

![](assets/001/02/01/03-1615216912617.png)


* 那么 nologin 类型shell 有啥用呢。 就是系统的一些进程运行的时候就是用这些账号运行的

![](assets/001/02/01/03-1615216758430.png)

### /etc/passwd 文件总结


passwd文件内容每行是用【:】符号分隔，共有7列字段，分别如下：
用户名:口令:用户标识号:用户组标识号:注释说明:用户主目录:默认shell

1、用户名：代表用户账号的字符串。用户名字符可以是大小写字母、数字、减号（不能出现在首位）、点以及下划线，其他字符不合法。虽然用户名中可以出现点，但不建议使用，尤其是首位为点时，另外减号也不建议使用，因为容易造成混淆。

2、口令：为什么是 ‘x’ 呢？早期的unix系统口令确实是存放在这里，但基于安全因素，后来就将其存放到 ‘/etc/shadow’ 中了，在这里只用一个 ‘x’ 代替。

3、用户标识号：也叫做uid。系统识别用户身份就是通过这个数字来的，0就是root，也就是说你可以修改test用户的uid为0，那么系统会认为root和test为同一个账户。通常uid的取值范围是0-65535(但实际上已经可以支持到4294967294)，0是超级用户（root）的标识号，1-499由系统保留，作为管理账号，普通用户的标识号从500开始，如果我们自定义建立一个普通用户，你会看到该账户的标识号是大于或等于500的。

4、用户组标识号：表示组标识号，也叫做gid。这个字段对应着/etc/group 中的一条记录，其实/etc/group和/etc/passwd基本上类似。
5、注释说明：该字段没有实际意义，通常记录该用户的一些属性，例如姓名、电话、地址等等。不过，当你使用finger的功能时就会显示这些信息的（稍后做介绍）。

6、用户主目录：当用户登录时就处在这个目录下。root的家目录是/root，普通用户的家目录则为/home/username，这个字段是可以自定义的，比如你建立一个普通用户test1，要想让test1的家目录在/data目录下，只要修改/etc/passwd文件中test1那行中的该字段为/data即可。

7、默认shell：用户登录后要启动一个进程，用来将用户下达的指令传给内核，这就是shell。Linux的shell有很多种sh, csh, ksh, tcsh, bash等，而Redhat/CentOS的shell就是bash。查看/etc/passwd文件，该字段中除了/bin/bash外还有/sbin/nologin比较多，它表示不允许该账号登录。如果你想建立一个账号不让他登录，那么就可以把该字段改成/sbin/nologin，默认是/bin/bash.


## 下面是 /etc/shadow 文件

### shadow 文件

shadow 英文就是影子，刚好也说明了密码，不能放到光天化日之下！但肯定有一些安全措施的

![](assets/001/02/01/03-1615217301458.png)

![](assets/001/02/01/03-1615302126251.png)


* 看下shadow 文件的描述信息


命令：man 5 shadow 


![](assets/001/02/01/03-1615217520216.png)

![](assets/001/02/01/03-1615217468865.png)

> 1 查看文件 


![](assets/001/02/01/03-1615217584697.png)

### shadow 第1 2  列 用户名、密码

第一列就是用户名，第二列就是加密的密码

> 1 密码列

* centos6 shadow 密码使用的加密方式就是 sha512 （相比较md5 sha512 加密方式更安全）

![](assets/001/02/01/03-1615217777777.png)


* rhel5 ：对应 $1 加密方式是 md5 （md5 sha1 ：都已经被破解的）

![](assets/001/02/01/03-1615217670515.png)


* 那么不同用户口令如果相同，密文是不一样的，在密码列中的 第2-3 个 $ 符号之间就是 盐（salt:随机的盐， 保证相同口令加密之后密文不同。盐要是一样那密文就一样了）。（理论上加密口令是不可逆的-就是拿到密文你是推不出明文的）

* 加密算法也是可以人为修改的。 
而且像 md5 ,sha1-=sha512 都是哈希加密算法，不可逆(就是理论上倒着是算不出密码的【比如md5 就被破解了】)

![](assets/001/02/01/03-1615302272175.png)


> 2 密码加密以及修改方式

authconfig 命令也可以修改加密算法

![](assets/001/02/01/03-1615302358485.png)

* 但是修改完之后 shadow文件中的密文并不会作出改变

![](assets/001/02/01/03-1615302408705.png)

* 试一下修改一下小王 的密码

![](assets/001/02/01/03-1615302482015.png)

![](assets/001/02/01/03-1615302522137.png)

其实修改密码修改的是一个文件 ： /etc/login.defs 文件 。但其实命令也只是改了配置文件，但只是是不容易改错文件


![](assets/001/02/01/03-1615302733336.png)


> 3 加密的复杂性策略

![](assets/001/02/01/03-1615302987095.png)

* 1 平时有规律的密码你比如

    ysyhl9t
    !QAZ2wsx
    p@ssw()rd
    ....

     等等之类似有规律的也是有可能被存入到暴力破解密码库中

* 2 所以你密码可以设置随机的

比如：openssl rand -base64 9 的随机数

![](assets/001/02/01/03-1615303384625.png)

### shadow 第3 列 最近一次修改密码距离1970年天数

![](assets/001/02/01/03-1615218291866.png)

![](assets/001/02/01/03-1615302665716.png)


> 1 看下介绍


第三列是你修改密码的最后时间。但是他这计算方式是通过计算 距离 1970.01.01 的天数算出来的。 所以上述图片中 17618 就是最后修改时间与 70年相差了17618天. 

如果此值为0 ，那么用户下次登录系统的时候就会提示用户更改口令。那就意味着如果此值为0  ，那么用户下次登录就需要修改密码了。

![](assets/001/02/01/03-1615218371374.png)

可以使用date 命令 计算当前时间距离 1970年 天数 ，如下图

bc命令就是 在linux 中当计算器使用 [菜鸟教程bc](https://www.runoob.com/linux/linux-comm-bc.html)


![](assets/001/02/01/03-1615218573469.png)


### shadow 第 4列  最短有效口令（至少用几天才能改）

* 最短口令有效期-就是一个密码你至少得用多久才能修改密码，让用户不能随意更改密码。 

假设设置为3 就意味着三天之内 你不能修改你的密码。当然为0 就为这你随时都能修改你的口令； 也是为了防止用户容易记密码；

![](assets/001/02/01/03-1615218979171.png)


![](assets/001/02/01/03-1615219107512.png)

### shadow 第五列- 口令过期还差几天

* 口令再过多少天就会过期；99999 差不多 273年

![](assets/001/02/01/03-1615219173032.png)

![](assets/001/02/01/03-1615219143552.png)


* win中 查看 密码有效期 ：net accounts 命令


![](assets/001/02/01/03-1615219352511.png)

![](assets/001/02/01/03-1615219421381.png)


### shadow 第六列- 过期前多少天提醒

* 如果linux 密码快过期了，多久会通知用户呢，过期前7天；

![](assets/001/02/01/03-1615219468449.png)


* 比如修改了如下 值， （密码有效期 7 天 ，过期提前5天 提醒 ）

![](assets/001/02/01/03-1615219723461.png)

过期提醒 ：

![](assets/001/02/01/03-1615219645761.png)


### shadow 第7 列 过期之后还能用多久

* 宽限期，单位也是天； 

![](assets/001/02/01/03-1615219815184.png)


### shadow 第8 列- 账户有效期

* 有时候合作公司的人来工作了。你给个账号，可以设置个有效期

![](assets/001/02/01/03-1615219971713.png)


### shadow 第 9 列 -保留字段

保留字段，说明文档中也说了 。保留字段也许用得着，也许用不着

![](assets/001/02/01/03-1615220033068.png)


![](assets/001/02/01/03-1615304030346.png)


### usermod -U/-L  解锁/锁定 账户

> 1 所以新创建的账号如果不给密码，那么shadow 中对应的就是 ！！ 叹号，此时用户也登不上系统，所以 ！！ 在这里也可以表示锁定账户的意思，一个感叹号也是表示锁定的意思


![](assets/001/02/01/03-1615304616446.png)

*  useradd mage 创建账号 

* 查看新账号对应密码字段

![](assets/001/02/01/03-1615304816937.png)

* 如果删除两个感叹号，那么不需要密码即可登录

![](assets/001/02/01/03-1615304922012.png)

![](assets/001/02/01/03-1615304898471.png)

* 也可以用命令去除 ！ （centos6 -U 解锁开始就已经不允许这种方式了，【usermod -L 用户名 依然可以用于枷锁 】所以命令解锁 usermod -U 这种centos 6 就不允许了 ，知道就行了 ）

命令：usermod -U 用户名 
    
    U ：Unlock 的意思  。 -L 就是枷锁的意思
    执行一次少一个！，要想两个！！ 都去掉，就执行两次就行了


centos6 中会提示不安全，不允许：

![](assets/001/02/01/03-1615305228596.png)


* 加锁一个有密码的账户，密码字段前面会有一个！ ，此时也说明用户账号被锁了，登录是不可以的

![](assets/001/02/01/03-1615305405671.png)

* 但是usermod -L 锁定的用户，虽然不能登陆了。是可以切换到该用户的

![](assets/001/02/01/03-1615305475756.png)


### 立即过期密码 ： passwd -e 用户名

以wang 账户为例：

    命令： passwd -e wang  
    还有另外一种方式，让用户密码立即失效：chage -d 0 wang 

![](assets/001/02/01/03-1615305653661.png)

![](assets/001/02/01/03-1615305757845.png)


### 查看密码情况： chage -l 用户名 


![](assets/001/02/01/03-1615305942186.png)


### 修改账户密码情况 ：chage 用户名


![](assets/001/02/01/03-1615306081694.png)



### 修改默认新用户的有效期 ： 修改 /etc/login.defs

![](assets/001/02/01/03-1615306297723.png)



* 比如新建一个 nginx 账号

修改配置文件：

![](assets/001/02/01/03-1615306346725.png)

修改完创建一个 nginx 账户，并进行查看

![](assets/001/02/01/03-1615306329730.png)

> 2 而且defs 文件中 就定义了创建用户的起始id ，


* centos6 中 是 500开始

![](assets/001/02/01/03-1615389920387.png)

* centos7 zhogn 是 1000 开始


![](assets/001/02/01/03-1615389900854.png)

![](assets/001/02/01/03-1615389886914.png)


### 邮箱接受地址：也在  /etc/login.defs 这个文件中配置


![](assets/001/02/01/03-1615306462205.png)

查看邮箱命令 ：mail 

![](assets/001/02/01/03-1615306484164.png)



![](assets/001/02/01/03-1615389490735.png)

邮件文件内容：

![](assets/001/02/01/03-1615389540134.png)

* 删掉这个文件。wang账号的邮件就被清空了 

![](assets/001/02/01/03-1615389572364.png)

* 而邮箱文件创建用户的时候，系统会自动创建对应的邮箱文件


![](assets/001/02/01/03-1615389682445.png)


### 创建用户之后会创建对应用户的家目录

![](assets/001/02/01/03-1615389758777.png)


### 创建用户有关的系统配置文件  : /etc/default/useradd

> 1 创建用户时有关的系统配置文件，比如默认创建邮箱文件与否啊



![](assets/001/02/01/03-1615390693436.png)


> 2 skel 

![](assets/001/02/01/03-1615390174465.png)


* 进入 skel 文件，当然这里都是隐藏文件


![](assets/001/02/01/03-1615390212616.png)


![](assets/001/02/01/03-1615390301637.png)

### 总结创建账号相关的文件

![](assets/001/02/01/03-1615391276962.png)






## /etc/group 文件格式

![](assets/001/02/01/03-1615390814728.png)

### 查看文件数据

* 这里就有一个组id 就是 100 的，那么默认创建的用户也就被分配到这个组中了

![](assets/001/02/01/03-1615390876105.png)


### 创建用户 -N参数

> 1 linux 中一个用户必须有一个主组，win 中就可以不属于组

![](assets/001/02/01/03-1615391096013.png)



### /etc/group 文件描述

![](assets/001/02/01/03-1615304385174.png)

group：组名：组密码：组id:组成员

组的成员用逗号隔开

![](assets/001/02/01/03-1615391362763.png)


### linux 中 group密码意义何在呢

* linux 中普通用户可以把自己加入到某个组中，前提是得知道这个口令。但是一般linxu不建议，因为用户加入某个组就相当于有了某个组中的一些权限 

* win 中只能管理员有这个权限

### 组成员 


![](assets/001/02/01/03-1615392333218.png)

上述group中代表： wang,root,bin三个用户 附加组是 mage组，wang 用户主组是wang 组

* 查看用户所属组信息

groups wang : 查出来的 wang: wang mage  ，排在最前面的是主组，后面都是附加组

![](assets/001/02/01/03-1615392447864.png)


### id  有些信息是需要重新登录

* （id） 命令 查看 与 （id 用户）命令 查看数据得位置不一样；

id 用户名：是从 /etc/group 中看的 ，所以信息是比较准确的

* 比如吧 root 加入 mage组 为什么id 命令看不到，因为需要重新登录（id 后不加参数需要重新登录看，id root 加上用户名是能看到的）


![](assets/001/02/01/03-1615392767588.png)
![](assets/001/02/01/03-1615392691482.png)


### 账号登陆过的被分配组的用户，需要重新登录

* 如果账号已经登录了，但是这个时候被分到了一个组中，但是你需要重新登录才行。![](assets/001/02/01/03-1615393294492.png)


### 问题来了，如果工作中一个员工离职了，新来的员工想拥有跟旧员工一样的权限，怎恶办？


* 难道要一个一个查询就员工的权限？然后挨个给新员工账号赋值？ 那你不得疯了。

1. 一般都是直接在 /etc/passwd 中吧就员工名字改了
2. 且 去 /etc/shadow 中的主组名字改了就行了 
3. 且也可以去吧以前就用户对应的家目录文件名改一下

## /etc/gshadow 

### gshadow 文件描述

    组名：
    密码（当然一般都 ！！ 不设置密码，让其锁定，使得普通用户不能直接知道密码把自己拉进去）：
    都谁可以将别人拉进该组（设置组长，逗号隔开）：
    组成员(这个字段含义与 /etc/group 的最后一个字段是一样的，但是如果设置不统一就容易出现一些命令错误，但是一般不会，因为一般拉用户入组都是命令方式，不是直接该配置文件，系统会自动同步)

## gshadow 文件每列含义



组名：加密密码：组管理员：组附加用户列表

![](assets/001/02/01/03-1615393608215.png)


## 修改组的密码

> 1 为组设置口令

* 1 gpasswd 组名


![](assets/001/02/01/03-1615711933236.png)

* 2 查看设置好的密码

![](assets/001/02/01/03-1615711974855.png)


> 2 将wang 用户添加到 mage 组

* 1 在这之前，先用wang 创建一个文件，文件信息如下


![](assets/001/02/01/03-1615712223176.png)

* 2 使用 newgrp 组名， 命令 将自己添加到mage 组，注意因为设置过了 mage 组口令，所以输入口令即可

    可以看到此时 wang 账号 所属 ’主组‘ 已经是mage 组 ，而不再是自己的 wang 组了 

创建一个文件再看下信息：

![](assets/001/02/01/03-1615712429696.png)

![](assets/001/02/01/03-1615712306304.png)


> 3 将wang 所属主组改为自己的wang 组 

    
* 此时wang 已经是mage了，此时修改配置文件 


![](assets/001/02/01/03-1615712591654.png)


![](assets/001/02/01/03-1615712546203.png)


> 4 如果想要创建文件主组为 mage 组的话 怎么办？  使用 newgrp 组名命令

* 而此时 也不需要输入口令，因为 已经在 mage组中了 。

![](assets/001/02/01/03-1615712851623.png)


![](assets/001/02/01/03-1615712930163.png)

* 创建文件 再次看下 

![](assets/001/02/01/03-1615712975395.png)


所以 nwegrp 命令 可以临时修改用户所属主组， 如果当前用户在对应组就可以不用输入口令

* 今天到此结束：接下来是gshadow 的密码

地址 : https://www.bilibili.com/video/BV1bt411f7Bv?p=4&spm_id_from=pageDriver



## 与组用户有关的文件操作

1. vipw 和 vigr

2. pwck 和 grpck 


### vipw 


* 我们知道如果修改 /etc/passwd 进行直接修改，可能会因为格式错误导致其他问题， vipw 好处就在于有语法检查功能
相当于 : 
vi  /etc/passwd    或者  nano   /etc/passwd  

vi与nano 都是文本编辑命令 ,nano 说是比较简单我感觉都差不多都需要去熟悉命令-[区别](http://www.178linux.com/83952)

### vigr

vipw 知道了， vigr 也差不多，vigr 相当于： vi /etc/group

### pwck 用于检查  /etc/passwd 文件格式是否有错误，以及警告

### grpck 就是检查  /etc/group 文件的

所以一般修改上述四个配置文件一般不推荐直接 修改内容的。有专门的修改命令以及检查命令


## 用户和组管理命令


![](assets/001/02/01/03-1615714389781.png)


### useradd 命令


> 1 介绍

![](assets/001/02/01/03-1615714445102.png)


* useradd 命令 在 sbin 里面 ，而 sbin 里面一般都是管理员命令，所以  <font color='red'>普通用户是不能创建用户的</font>

![](assets/001/02/01/03-1615714490193.png)

* 命令参数：

![](assets/001/02/01/03-1615714597571.png)


### -u 参数 

* -u 意思是指定 用户的uid ，可以超过配置文件配置的范围

> 1 比如命令： useradd -u 66666 xixi  


> 2 查看创建的用户 ： getent passwd  用户名  

查看指定的用户信息，如果不加用户名参数 就相当于  :cat /etc/passwd 

![](assets/001/02/01/03-1615731551354.png)

<font color='red'>注意新增用户id ，是以  /etc/login.defs 配置文件为主，有个  UID_MIN 与 UID_MAX  ，如果上次创建用户id 在 此范围内，那么下次id 就是范围内最大id 的累加1 ，否则则不遵循上次id +1 的规则 。 但是也不尽然，如果上个uid 最大了，那么系统递增不上去了，那么就会回头扫描对应的空缺id 作为下次新用户id </font>


![](assets/001/02/01/03-1615732373697.png)

> 3 如下两个例子

* 1  创建 id为 66666 之后的用户，在创建用户的话不会按照上次的uid 累加，而是最后一次自动添加的id 累加

![](assets/001/02/01/03-1615731803794.png)


* 2 但是如果上一次创建用户id 为 2000 的用户，那么下次创建的用户id 就是 2001 

![](assets/001/02/01/03-1615732198834.png)

* 3 但是也不尽然，如果上个uid 最大了，那么系统递增不上去了，那么就会回头扫描对应的空缺id 作为下次新用户id 

![](assets/001/02/01/03-1615732698747.png)



> 4 指定用户id 有什么用呢

如果以后想要在不同电脑上装相同软件，都需要一样的用户名，如果不指定id 那肯定是不行的



### -o 参数 


> 1 介绍

<font color='red'> 可以不检查uid 唯一性，但是不推荐这样</font>

不让 创建用户的时候检查id 唯一，在系统中如果创建用户不加o参数，是会报错的

![](assets/001/02/01/03-1615733108763.png)


* 加上o 就可以不检查uid 唯一性

![](assets/001/02/01/03-1615733138667.png)

* 查看用户信息，id相同，系统会认为用户都是同一用户（具体以哪个用户为准呢，文件中排在前面的）

![](assets/001/02/01/03-1615733202807.png)


> 2 删除用户时会有问题

![](assets/001/02/01/03-1615733480308.png)


删除同uid 用户，那么家目录是不会被删除，而是所属用户名，以及组名改为了 uid 与 所属组id。

所以在linux中判断用户是否有权访问对应的文件 看的是 文件描述中的id 信息。

![](assets/001/02/01/03-1615733606409.png)


* 所以此时再次创建一个uid 为 2000 的用户，那么 新用户所属家目录就是上两个被删除的用户的家目录了

![](assets/001/02/01/03-1615733786036.png)


### -g 命令，知名用户所属基本组，可为组名，也可为 组id

如果创建用户指定了基本组，那么就不会在创建一个与新用户同名的组了

![](assets/001/02/01/03-1615734010855.png)


### -c 命令，添加用户描述

* 当前前面也有个 chfn + 用户名 。命令修改用描述

![](assets/001/02/01/03-1615734068126.png)





### -d 指定新用户的家目录

* 指定 /home 之外的地方都可以作为家目录，当然创建的家目录也有一些配置文件

![](assets/001/02/01/03-1615734211830.png)

![](assets/001/02/01/03-1615734264476.png)

-d 命令可以在用户名之后之前都可以

![](assets/001/02/01/03-1616058269083.png)

当一些程序对应的用户需要有对应目录的访问权限要求的时候，创建用户的时候可以顺便指定家目录为某个目录


### -s 指定shell类型


> 1 指定shell类型。

![](assets/001/02/01/03-1616058665713.png)


> 2 -r 创建系统用户 （默认-r 家目录不创建，邮箱也不创建）


![](assets/001/02/01/03-1616058851969.png)

* 你比如创建给nginx 软件使用的用户，指定 nologin 与 指定为系统用户

* -r 加上就不会给创建家目录

![](assets/001/02/01/03-1616059007066.png)


### -m 强行创建家目录


![](assets/001/02/01/03-1616059098873.png)


### -M 强行不创建家目录，针对非系统用户

![](assets/001/02/01/03-1616059237984.png)

* 家目录不创建但是邮箱会创建

![](assets/001/02/01/03-1616059267832.png)



### -G 指定用户附加组 ，组必须存在

![](assets/001/02/01/03-1616059530168.png)


* 创建  alice 用户 ，附加组为  app1 app3 

![](assets/001/02/01/03-1616059432697.png)

* 查看信息

![](assets/001/02/01/03-1616059478178.png)


### -N 不创建私用组做主组

![](assets/001/02/01/03-1616059545296.png)


* 默认是users 组 的原因就是 /etc/default 的配置文件


![](assets/001/02/01/03-1616059639497.png)


* 示例：

![](assets/001/02/01/03-1616059661416.png)


###   useradd  默认设定 

![](assets/001/02/01/03-1616060390327.png)

* 在文件 /etc/default/useradd 中

#### -D 可以修改默认配置

* 例如修改默认shell 

![](assets/001/02/01/03-1616060398793.png)


* 改完之后创建的账号的默认shell类型就是 指定的类型

![](assets/001/02/01/03-1616060490199.png)


### 一些练习


![](assets/001/02/01/03-1616060535790.png)


> 1 第一题

![](assets/001/02/01/03-1616060936385.png)


* 验证：

![](assets/001/02/01/03-1616060969071.png)

![](assets/001/02/01/03-1616061000226.png)


> 2 第二题

* 1 创建组： groupadd webs

查看组：

getent group  或者  cat /etc/group

![](assets/001/02/01/03-1616061118024.png)

* 创建用户


useradd nginx  -G webs
useradd varnish -G webs
useradd mysql -s /sbin/nologin

修改密码：
passwd 用户名

//

echo magedu | passwd --stdin mysql 



## 批量创建用户


newusers passwd 格式文件 批量创建用户
chpasswd 批量修改用户口令



### 加入想要批量将a主机用户批量copy到其他主机上


> 1 copy  /etc/passwd 中的内容 

![](assets/001/02/01/03-1616321036426.png)


> 2 创建一个文件 Filelist.txt 复制进去，copy到其他主机上

![](assets/001/02/01/03-1616321001147.png)


* 使用scp 命令，

![](assets/001/02/01/03-1616321101411.png)

> 3 使用命令批量创建 newusers

![](assets/001/02/01/03-1616321201163.png)

## 批量修改用户密码

### 创建对应的文件  用户名：密码 的格式

> 1. 创建 pass.txt文件

![](assets/001/02/01/03-1616321331234.png)


> 2. 执行命令：cat pass.txt | chpasswd

![](assets/001/02/01/03-1616321401514.png)


## 用户属性修改命令


![](assets/001/02/01/03-1616321484802.png)



### 修改附加组


![](assets/001/02/01/03-1616321595138.png)


* 查看用户

![](assets/001/02/01/03-1616321618050.png)


### 修改附加组同时保留付家组  -a 参数



![](assets/001/02/01/03-1616321719691.png)

* 取消wang账户的所有付家组


![](assets/001/02/01/03-1616322005346.png)

* 取消用户所有付家组的另一种写法


![](assets/001/02/01/03-1616322062466.png)


### -l 修改用户名 ：  usermod  -l  新用户名   旧用户名


### -f 设定非活动期限 ，也就是账号过期之后还能用几天的那个变量



## 删除用户

* -r 如果不加-r 则不会删除对应的 家目录与邮箱

![](assets/001/02/01/03-1616322500034.png)


## 查看用户命令


![](assets/001/02/01/03-1616322747569.png)

* 如下

![](assets/001/02/01/03-1616322729682.png)



## 关于切换用户以及用其他用户身份执行命令

![](assets/001/02/01/03-1616322854553.png)


### su 切换用户


> 1  root  切换 到 wang 账号

![](assets/001/02/01/03-1616322947866.png)

* 可见切换并不完全，因为所在目录还是在root目录， 都知道wang 或者其他用户无权限访问root 可见 ls 都无法展示root下的文件


![](assets/001/02/01/03-1616323062450.png)

> 2 切换不完善体现在

    所在目录没变化
    一些环境变量也依然是切换前的账户的

* 如下，root切换了wang ，但是  $PATH 依然是root的

![](assets/001/02/01/03-1616323193409.png)


#### 完全切换 ： su  -  用户名 


> 1 完全切换等价于：重新登录了


![](assets/001/02/01/03-1616323290610.png)


* 普通用户切换为root： 可以直接 ：su -  不用写用户名，默认是root 但是需要密码


![](assets/001/02/01/03-1616328446399.png)


> 2 su 切换命令注意事项，最好切换完用户使用 exit 或者logout退回去，因为有时候来回切换，可能每次是不一样的切换(完全与不完全切换，系统也有可能会出毛病)

### -c 命令切换身份执行命令，然后在切换回原账号


 ![](assets/001/02/01/03-1616328598112.png)


### 设置密码


![](assets/001/02/01/03-1616328777871.png)


### 批量删除当前未登录状态的所有用户


![](assets/001/02/01/03-1616329054335.png)


## 创建组 :groupadd  组名

![](assets/001/02/01/03-1616328905215.png)


> 1 一般情况可以将创建用户id 与用户主组id 一样

![](assets/001/02/01/03-1616329163408.png)


## 删除组 : groupdel 组名

> 2 删除组需要注意，如果一个组是一个用户的主组，那么该组是不能被删除的


![](assets/001/02/01/03-1616329423583.png)


* 所以如果非要删除某个组，可以将组下的人移动到其他组中即可


## 更改组密码：gpasswd


> 1 gpasswd 添加 、删除 指定组中的用户

 gpasswd -a 用户名 组名 
 gpasswd -d 用户名 组名 

> 2 指定某用户为某个足的管理员

 gpasswd -A 用户名 组名  

 则 /etc/gshadow 文件中 ，倒数第二个字段就是改组中管理员名字

 ![](assets/001/02/01/03-1616330139983.png)


![](assets/001/02/01/03-1616329550975.png)


### 更改，查看组成员


![](assets/001/02/01/03-1616330219630.png)

* groupmems 查看、添加、删除指定组中的用户 与 gpasswd -a 差不多

groupmems -l -g 组名 ： 查看某个组中的成员
groupmems -a 用户 -g 组名 ： 向指定组中添加人
groupmems -d 用户 -g 组名 : 向指定组中删除某用户


![](assets/001/02/01/03-1616329739310.png)


## 查看用户所属组 : groups 用户名
