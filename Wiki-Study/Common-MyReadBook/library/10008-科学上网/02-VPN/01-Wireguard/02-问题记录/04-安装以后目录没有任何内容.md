安装了WireGuard后，发现 `/etc/wireguard`目录是空的，这通常是因为还没有创建任何的WireGuard配置文件。WireGuard在安装时不会自动生成默认配置文件，需要您手动创建。下面是一个快速解决问题的步骤概览：

| 步骤                      | 核心操作                               | 关键命令/提示                                  |
| :------------------------ | :------------------------------------- | :--------------------------------------------- |
| **① 检查安装**     | 确认WireGuard是否已正确安装。          | `wg --version`                               |
| **② 创建配置目录** | 确保配置目录存在且有合适权限。         | `sudo mkdir -p /etc/wireguard`               |
| **③ 生成密钥对**   | 为设备（服务器或客户端）创建身份凭证。 | `wg genkey` 和 `wg pubkey`                 |
| **④ 编写配置文件** | 定义WireGuard接口和对等节点参数。      | 编辑 `/etc/wireguard/wg0.conf`（示例见后文） |
| **⑤ 启动与测试**   | 应用配置并验证连接。                   | `sudo wg-quick up wg0`                       |

### 🔑 生成密钥与配置文件

1. **生成密钥对**：在终端中依次执行以下命令，为你的设备生成一对私钥和公钥。请务必**妥善保管私钥**，不要泄露。

   ```bash
   cd /etc/wireguard
   sudo umask 077 # 设置严格的权限掩码，确保新生成的文件仅对所有者可读
   sudo wg genkey | tee privatekey | wg pubkey > publickey
   ```

   执行后，你会在 `/etc/wireguard`目录下得到 `privatekey`和 `publickey`两个文件，分别包含你的私钥和公钥。
2. **创建配置文件**：接下来，你需要创建一个配置文件，例如 `wg0.conf`。你可以使用 `sudo vim /etc/wireguard/wg0.conf`来创建并编辑。

   - 一个**最基本的服务器端**配置示例：

     ```ini
     [Interface]
     PrivateKey = <上面生成的server_private.key内容>
     Address = 10.0.8.1/24 # 定义服务器在VPN网络中的IP
     ListenPort = 51820 # 指定服务器监听的端口
     PostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -A FORWARD -o wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
     PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -D FORWARD -o wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE
     # 上述PostUp和PostDown规则用于配置数据包转发和NAT，使得客户端流量能通过服务器访问互联网或其他网络。
     ```

     关于配置文件中IP地址后斜杠和数字（如 `/24`）的含义，我之前已经解释过，这里不再赘述。
   - 一个**基本的客户端**配置示例：

     ```ini
     [Interface]
     PrivateKey = <客户端私钥>
     Address = 10.0.8.2/24 # 客户端在VPN网络中的IP

     [Peer]
     PublicKey = <服务器的公钥>
     Endpoint = <你的服务器公网IP>:51820
     AllowedIPs = 0.0.0.0/0 # 表示将所有流量都通过VPN隧道发送
     PersistentKeepalive = 25 # 可选，用于在NAT后维持连接
     ```

   **注意**：在实际填写时，你需要将 `< >`括起来的部分替换为你自己生成的密钥和实际的服务器IP。完整的服务器和客户端配置，需要将各自的 `[Peer]`部分相互配对。

### 🚀 启动与验证连接

1. **启动WireGuard**：使用以下命令启动你刚创建的接口（这里以 `wg0`为例）：

   ```bash
   sudo wg-quick up wg0
   ```
2. **检查连接状态**：启动后，可以使用以下命令查看接口状态和连接详情：

   ```bash
   sudo wg show
   ```

   如果输出中显示了你的接口和对等端信息，并且有最新的握手时间，说明连接成功。
3. **设置开机自启**：如果测试无误，可以设置WireGuard在系统启动时自动运行：

   ```bash
   sudo systemctl enable wg-quick@wg0
   ```

### 🛠️ 故障排除与温馨提示

- **权限问题**：如果在编辑或创建配置文件时遇到"Permission denied"之类的错误，记得使用 `sudo`命令来提升权限。
- **内核支持**：极少数情况下，如果 `wg-quick up`命令失败并提示"Protocol not supported"，可能需要检查并确保WireGuard内核模块已正确安装和加载。
- **防火墙与端口**：请确保你的服务器防火墙（如 `ufw`）或云服务商的安全组规则，已经允许UDP协议在 `ListenPort`指定端口（默认是 `51820`）上的入站连接。

希望这些详细的步骤能帮助你顺利完成WireGuard的配置。如果在操作过程中遇到其他问题，随时可以再来问我。
