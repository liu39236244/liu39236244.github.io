非常好！您的客户端都能ping通服务器，这说明WireGuard隧道已经建立成功。现在需要解决客户端之间无法互相ping通的问题。这通常是因为**路由和防火墙规则**没有正确配置。

## **问题根源分析**

当客户端A ping客户端B时：
1. 数据包通过WireGuard隧道到达服务器
2. 服务器需要将数据包转发给另一个客户端
3. 这需要正确的路由和防火墙规则

## **解决方案**

### **1. 检查服务器路由转发**

在**服务器**上确认IP转发已开启：

```bash
# 检查IP转发状态
cat /proc/sys/net/ipv4/ip_forward
# 应该输出 1

# 如果输出是 0，需要开启
echo 'net.ipv4.ip_forward=1' | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
```

### **2. 检查服务器WireGuard配置**

确保服务器配置中包含了**两个客户端的Peer信息**：

**服务器配置 (`/etc/wireguard/wg0.conf`)**：
```ini
[Interface]
Address = 10.10.66.1/24
PrivateKey = <服务器私钥>
ListenPort = 51820
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE

[Peer]
# 客户端1 - Win电脑
PublicKey = <客户端1公钥>
AllowedIPs = 10.10.66.2/32

[Peer]
# 客户端2 - 公司服务器
PublicKey = <客户端2公钥>
AllowedIPs = 10.10.66.3/32
```

### **3. 检查客户端配置**

**客户端1 (Win电脑) 配置**：
```ini
[Interface]
PrivateKey = <客户端1私钥>
Address = 10.10.66.2/24

[Peer]
PublicKey = <服务器公钥>
Endpoint = 47.95.43.103:51820
AllowedIPs = 10.10.66.0/24
PersistentKeepalive = 25
```

**客户端2 (公司服务器) 配置**：
```ini
[Interface]
PrivateKey = <客户端2私钥>
Address = 10.10.66.3/24

[Peer]
PublicKey = <服务器公钥>
Endpoint = 47.95.43.103:51820
AllowedIPs = 10.10.66.0/24
PersistentKeepalive = 25
```

### **4. 关键：修改防火墙规则**

您当前的 `PostUp` 规则只做了MASQUERADE（让客户端能访问互联网），但没有处理客户端之间的转发。需要修改为：

```ini
PostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -A FORWARD -o wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -D FORWARD -o wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE
```

**或者更简单的方案**（推荐）：
```ini
PostUp = iptables -I FORWARD -i wg0 -j ACCEPT; iptables -I FORWARD -o wg0 -j ACCEPT; iptables -t nat -I POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -D FORWARD -o wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE
```

### **5. 应用配置**

修改配置后，在**服务器**上重启WireGuard：

```bash
sudo wg-quick down wg0
sudo wg-quick up wg0
```

### **6. 测试连接**

现在测试客户端之间的连通性：

**在客户端1 (Win电脑) 上：**
```cmd
ping 10.10.66.3
```

**在客户端2 (公司服务器) 上：**
```bash
ping 10.10.66.2
```

### **7. 如果仍然不通，检查状态**

在**服务器**上检查：
```bash
# 检查WireGuard状态
sudo wg show

# 检查iptables规则
sudo iptables -L FORWARD -v

# 检查路由表
ip route

# 实时监控数据包
sudo tcpdump -i wg0 -n
```

## **排查要点**

1. **确保两个客户端都在服务器的Peer列表中**
2. **检查防火墙规则是否正确允许转发**
3. **确认IP转发已开启**
4. **检查客户端配置中的AllowedIPs包含对方IP段**

请先尝试修改防火墙规则（第4步），这通常能解决90%的客户端互通问题。如果还有问题，请提供 `sudo wg show` 和 `sudo iptables -L FORWARD -v` 的输出。