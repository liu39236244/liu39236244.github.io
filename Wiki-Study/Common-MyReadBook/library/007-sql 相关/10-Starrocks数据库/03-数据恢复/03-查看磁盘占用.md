好的，这是一个非常核心和常用的运维需求。查看 StarRocks 集群各节点占用的物理空间，有多种方法，从简单直观的 SQL 查询到深入服务器底层的命令，各有侧重。

我们由浅入深，介绍四种最主要的方法。

---

### 方法概览

| 方法           | 命令/工具            | 查看内容                                       | 优点                                 | 缺点                                   |
|:---------------|:---------------------|:-------------------------------------------|:-----------------------------------|:-------------------------------------|
| **SQL 命令**   | `SHOW BACKENDS;`     | StarRocks 内部管理的**数据**使用量，不含日志等。 | 快速、方便，无需登录服务器，最常用。     | 不反映磁盘的**完整**物理占用情况。      |
| **Web UI**     | 浏览器访问 `FE:8030` | 与 SQL 命令相同，但以图形化界面展示。            | 直观、对新手友好，信息全面。            | 需要浏览器访问权限。                    |
| **服务器命令** | `df -h`              | **真实、完整**的物理磁盘分区使用情况。           | 绝对准确，是排查磁盘满问题的最终依据。 | 需要逐一登录到每台 BE 服务器，稍显繁琐。 |
| **专业监控**   | Prometheus + Grafana | 自动化、可告警、可看历史趋势的磁盘使用情况。      | 生产环境最佳实践，自动化、可告警。      | 需要额外部署和配置监控系统。            |

---

### 方法一：使用 SQL 命令 `SHOW BACKENDS;` (最常用)

这是最快、最直接的方式，可以查看 StarRocks 自身认为的数据占用情况。

1.  用任何 MySQL 客户端连接到 StarRocks 的 FE 节点（默认 9030 端口）。
2.  执行以下命令：

    ```sql
    SHOW BACKENDS;
    ```

3.  **关注以下关键列：**

    *   `IP`: BE 节点的 IP 地址。
    *   `Alive`: 节点是否存活，必须为 `true`。
    *   **`DataUsedCapacity`**: **该 BE 节点上存储的数据的实际大小**。这是 StarRocks 内部统计的纯数据占用量。
    *   **`TotalCapacity`**: 该 BE 节点上配置的所有存储路径的总容量。
    *   **`UsedPct`**: **已用容量百分比** (`DataUsedCapacity / TotalCapacity`)。这是你最需要关注的指标之一。

**示例输出：**

```
+-----------+-----------------+----------+--------------------+--------------------+------------------+---------+
| BackendId | IP              | Alive    | DataUsedCapacity   | TotalCapacity      | UsedPct          | ...     |
+-----------+-----------------+----------+--------------------+--------------------+------------------+---------+
| 10001     | 192.168.5.137   | true     | 1.20 TB            | 10.00 TB           | 12.00 %          | ...     |
| 10002     | 192.168.5.169   | true     | 5.80 TB            | 10.00 TB           | 58.00 %          | ...     |
| 10003     | 192.168.5.228   | true     | 8.50 TB            | 10.00 TB           | 85.00 %          | ...     |
+-----------+-----------------+----------+--------------------+--------------------+------------------+---------+
```

从上表可以清晰地看到每个节点的磁盘数据占用情况，`192.168.5.228` 这个节点的使用率已经达到 85%，需要警惕了。

---

### 方法二：通过 Web UI 查看 (最直观)

StarRocks 的 FE 提供了一个 Web 界面，可以图形化地展示集群信息。

1.  打开浏览器，访问 FE Master 节点的 HTTP 端口（默认为 **8030**）。
    **URL**: `http://<fe_master_ip>:8030`
2.  登录后，在左侧导航栏找到并点击 **"BE 节点"** (或英文 "Backends")。
3.  你将看到一个与 `SHOW BACKENDS` 命令结果类似的表格，但通常带有进度条，视觉上更直观，可以一目了然地看到哪个节点的磁盘占用率最高。

---

### 方法三：登录服务器执行 `df -h` (最准确)

`SHOW BACKENDS` 显示的是 StarRocks 管理的数据大小，但**不包括** BE 的日志文件（`be.INFO`, `be.out`）、临时文件、垃圾回收站未清理的文件等。要查看服务器上**完整、真实**的磁盘占用，必须登录服务器。

1.  **逐一 SSH 登录到每一台 BE 节点的服务器上**。

2.  **确定 StarRocks 的数据存储路径**。
    这个路径在 BE 的配置文件 `be/conf/be.conf` 中定义，由参数 `storage_root_path` 指定。一个 BE 可以配置多个存储路径。

    ```bash
    # 在 BE 服务器上查看配置
    grep 'storage_root_path' /path/to/starrocks/be/conf/be.conf
    ```
    你可能会看到类似 `storage_root_path = /data1/starrocks,/data2/starrocks` 的配置。

3.  **执行 `df -h` 命令**。
    `df` (disk free) 命令用于显示文件系统的磁盘空间使用情况，`-h` (human-readable) 参数让输出结果更易读（如 GB, TB）。

    ```bash
    df -h
    ```

4.  **解读输出并与存储路径关联**。

    **示例输出：**
    ```
    Filesystem      Size  Used Avail Use% Mounted on
    /dev/sda1        50G  20G   30G  40% /
    /dev/sdb1       9.8T  1.3T  8.5T  13% /data1
    /dev/sdc1       9.8T  5.9T  3.9T  61% /data2
    ```
    假设你的 `storage_root_path` 配置在了 `/data1` 和 `/data2`。通过上面的输出，你就可以精确地知道：
    *   `/data1` 这个物理磁盘分区，总大小 9.8T，已使用 1.3T，使用率 13%。
    *   `/data2` 这个物理磁盘分区，总大小 9.8T，已使用 5.9T，使用率 61%。

    **这个方法是排查“磁盘已满”问题的最终手段，因为它反映了最真实的物理情况。**

---

### 方法四：使用 Prometheus + Grafana 监控系统 (生产环境最佳实践)

对于生产环境，手动检查效率低下。最佳实践是搭建自动化监控系统。

1.  **StarRocks BE 节点**会通过 HTTP 接口暴露大量的性能指标 (metrics)，其中就包括了磁盘使用相关的指标（如 `starrocks_be_storage_used_bytes` 和 `starrocks_be_storage_capacity_bytes`）。
2.  **Prometheus** 负责定期抓取这些指标并存储。
3.  **Grafana** 负责从 Prometheus 查询数据，并以图表的形式（如折线图、仪表盘）进行可视化展示。
4.  你可以配置**告警规则**（例如，当任意节点的 `UsedPct` 超过 85% 时，通过邮件或钉钉发送告警），实现主动运维。

StarRocks 官方和社区都提供了现成的 Grafana Dashboard 模板，可以很方便地导入和使用。

### 总结建议

*   **日常快速巡检**：使用 **`SHOW BACKENDS;`** 或 **Web UI**。
*   **精确排查磁盘问题**（比如 `SHOW BACKENDS` 显示占用不高，但服务器告警磁盘满）：**必须登录服务器用 `df -h`**，检查是不是日志文件过大或其他非数据文件占用了空间。
*   **生产环境长期运维**：**强烈建议搭建 Prometheus + Grafana** 监控体系。