# git 将线上代码 回退到指定版本



问题还原：
    A: 写了一天代码，push到master了 （或者有很多人也都push了）
    B: 也写了一天代码，pull 的时候没报冲突（我其实纳闷为啥pull的时候不报冲突），push 的时候爆冲突了。然后B 做了操作将冲突的代码解决冲突使用了本地的代码版本（这将会导致pull拉下来的最新代码（就是A push的新代码）在本地得不到合并（感觉应该相当于正常没拉成功）），随后B push 了上去（最后导致A push 的代码在线上又找不到了） 
    【这会导致A拉不下来代码，因为线上Apush过得代码应该是回退版本了】
    【B能正常 pull  代码 ， push不了代码，只不过b感觉代码不对劲儿，也不确定自己的到底成功push没以及pull 拉下来的代码是否是正确的线上代码】
    【A 这个时候应该是不能pull（因为先上代码被回退了） ，也不能push 的】


## 方式1 

场景：
    1 就单纯想要吧线上代码回退到某一版本。
    2 本地做的修改已经存了下来（藏匿还是copy出来一份 自己看情况）
    3 别人先暂停pull代码（）

逻辑：

    1 浏览器找到线上gitlib 想回退到的历史版本号
    2 使用 git reset --hard ****版本号 ，将本地代码回退到想要的版本(注意此时自己的修改的新代码会丢失；想办法藏匿修改或者记住修改过的文件)
    3 git push -f :强制将线上代码与本地回退后的代码同步（这一步需要取消分支保护）
    4 线上代码就会退成功，本地可以重新再改一次代码或者吧藏匿给展示出来


注意事项：这种方式是吧本地代码回退到主线上的某个历史版本，所以本地如果自己的代码还没有commit 的话，可以先暂时存储更改，要不然本地回退到某个历史版本了，你本地的新改的代码就没了！就没了！就没了！

参考博客：https://blog.csdn.net/u011429743/article/details/102938449


GitLab[master]回滚特定版本
应用场景,dev分支合并到master之后,发现不是应该提交的,所以master分支进行回滚

1.进入网页gitlab,找到项目的历史

![](assets/001/01/05-1615430862837.png)


2.找到自己项目所在的文件夹

![](assets/001/01/05-1615430920993.png)


3.输入命令,本地回滚到指定的版本,  备注:<font color="red">master取消保护分支--文章末尾有取消的操作</font>

如果不取消master 是无法回退版本的

$ git reset --hard XXXXX

![](assets/001/01/05-1615430965933.png)



4.输入命令,备注:如不取消master的保护分支会报错

git push -f :是强制推送代码的意思，会直接将线上代码改成本地的代码

$ git push -f

![](assets/001/01/05-1615431034656.png) 


## gitlab-master取消保护分支


解决方法如下：
找到Branches----project setting --Protected Branches–去掉master的protected即可

![](assets/001/01/05-1615431065430.png)


![](assets/001/01/05-1615431080431.png)


## 方式2 

场景：

在这种情况出现之后，其实 小乌龟的 commit 弹窗中能把 A 修改的哪些文件给回退到线上（就是A 正确修改需要的）版本。 只有本地push 之前 吧 当初pull 的那些操作失误按照了本地代码英勇的文件 给应用到A push 的那版代码之后。B 才能再次push 代码；
